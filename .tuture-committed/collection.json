{
  "name": "JavaScript 测试系列实战",
  "description": "",
  "id": "f40c6ffaaaa1f",
  "created": "2020-08-20T12:04:01.397Z",
  "articles": [
    {
      "id": "5e1396b8",
      "name": "JavaScript 测试系列实战（一）：使用 Jest 和 Enzyme 测试 React 组件",
      "description": "你或许早已经知道“单元测试”“端到端测试”这些名词，但从未真正付诸实践。在这一系列实战教程中，我们将手把手带你掌握 Jest、Enzyme、Cypress 等测试利器，帮助我们从 bug 的沼泽中挣脱出来，成为一个无往不利的高阶前端开发者！本篇教程是 JavaScript 测试系列实战 的第一篇教程，首先介绍了测试的类型，然后主要通过一个 React 项目教会你如何使用 Jest 编写第一个测试，然后使用 Enzyme 对 React 组件进行浅层渲染，以方便对不同层次的组件进行细粒度测试，当学习了这篇教程之后，你将对基础的测试编写、组件的测试有一个比较好的了解。",
      "topics": [
        "React",
        "Jest",
        "Enzyme"
      ],
      "categories": [
        "前端",
        "React",
        "进阶"
      ],
      "created": "2020-08-20T12:04:01.397Z",
      "cover": "https://static.tuture.co/c/f40c6ff/js-test-cover-1.jpg"
    },
    {
      "id": "387f95a1",
      "created": "2020-08-27T01:29:43.320Z",
      "name": "JavaScript 测试系列实战（二）：深层渲染和快照测试",
      "topics": [
        "React",
        "Jest",
        "Enzyme"
      ],
      "categories": [
        "前端",
        "React",
        "进阶"
      ],
      "cover": "https://static.tuture.co/c/f40c6ff/js-test-cover-2.jpg",
      "description": "在上一篇教程中，我们已经介绍了使用 Enzyme 测试 React 组件的基本知识。今天，我们将更深入地挖掘并学习如何测试组件的 Props，如何（以及为什么）使用 mount 函数，以及什么是 Jest 快照测试。"
    },
    {
      "id": "34217fa9",
      "created": "2020-08-31T06:34:17.128Z",
      "name": "JavaScript 测试系列实战（三）：深层渲染和快照测试",
      "topics": [
        "React",
        "Jest",
        "Enzyme"
      ],
      "categories": [
        "前端",
        "React",
        "进阶"
      ],
      "cover": "",
      "description": "在之前的两篇教程中，我们学会了如何去测试最简单的 React 组件。在实际开发中，我们的组件经常需要从外部 API 获取数据，并且组件的交互逻辑也往往更复杂。在这篇教程中，我们将学习如何测试更复杂的组件，包括用 Mock 去编写涉及外部 API 的测试，以及通过 Enzyme 来轻松模拟组件交互"
    }
  ],
  "steps": [
    {
      "type": "step",
      "id": "7598a3f5",
      "articleId": null,
      "commit": "796276585cc5686c3d29a705e90af08df6c04101",
      "children": [
        {
          "type": "heading-two",
          "commit": "796276585cc5686c3d29a705e90af08df6c04101",
          "id": "78bc042a",
          "fixed": true,
          "children": [
            {
              "text": "Initialize project using Create React App"
            }
          ]
        },
        {
          "type": "explain",
          "fixed": true,
          "children": [
            {
              "type": "paragraph",
              "children": [
                {
                  "text": ""
                }
              ]
            }
          ]
        },
        {
          "type": "file",
          "file": ".gitignore",
          "display": false,
          "children": [
            {
              "type": "explain",
              "fixed": true,
              "children": [
                {
                  "type": "paragraph",
                  "children": [
                    {
                      "text": ""
                    }
                  ]
                }
              ]
            },
            {
              "type": "diff-block",
              "file": ".gitignore",
              "commit": "796276585cc5686c3d29a705e90af08df6c04101",
              "hiddenLines": [],
              "children": [
                {
                  "text": ""
                }
              ]
            },
            {
              "type": "explain",
              "fixed": true,
              "children": [
                {
                  "type": "paragraph",
                  "children": [
                    {
                      "text": ""
                    }
                  ]
                }
              ]
            }
          ]
        },
        {
          "type": "file",
          "file": ".prettierrc",
          "display": true,
          "children": [
            {
              "type": "explain",
              "fixed": true,
              "children": [
                {
                  "type": "paragraph",
                  "children": [
                    {
                      "text": ""
                    }
                  ]
                }
              ]
            },
            {
              "type": "diff-block",
              "file": ".prettierrc",
              "commit": "796276585cc5686c3d29a705e90af08df6c04101",
              "hiddenLines": [],
              "children": [
                {
                  "text": ""
                }
              ]
            },
            {
              "type": "explain",
              "fixed": true,
              "children": [
                {
                  "type": "paragraph",
                  "children": [
                    {
                      "text": ""
                    }
                  ]
                }
              ]
            }
          ]
        },
        {
          "type": "file",
          "file": "README.md",
          "display": true,
          "children": [
            {
              "type": "explain",
              "fixed": true,
              "children": [
                {
                  "type": "paragraph",
                  "children": [
                    {
                      "text": ""
                    }
                  ]
                }
              ]
            },
            {
              "type": "diff-block",
              "file": "README.md",
              "commit": "796276585cc5686c3d29a705e90af08df6c04101",
              "hiddenLines": [],
              "children": [
                {
                  "text": ""
                }
              ]
            },
            {
              "type": "explain",
              "fixed": true,
              "children": [
                {
                  "type": "paragraph",
                  "children": [
                    {
                      "text": ""
                    }
                  ]
                }
              ]
            }
          ]
        },
        {
          "type": "file",
          "file": "package-lock.json",
          "display": false,
          "children": [
            {
              "type": "explain",
              "fixed": true,
              "children": [
                {
                  "type": "paragraph",
                  "children": [
                    {
                      "text": ""
                    }
                  ]
                }
              ]
            },
            {
              "type": "diff-block",
              "file": "package-lock.json",
              "commit": "796276585cc5686c3d29a705e90af08df6c04101",
              "hiddenLines": [],
              "children": [
                {
                  "text": ""
                }
              ]
            },
            {
              "type": "explain",
              "fixed": true,
              "children": [
                {
                  "type": "paragraph",
                  "children": [
                    {
                      "text": ""
                    }
                  ]
                }
              ]
            }
          ]
        },
        {
          "type": "file",
          "file": "package.json",
          "display": true,
          "children": [
            {
              "type": "explain",
              "fixed": true,
              "children": [
                {
                  "type": "paragraph",
                  "children": [
                    {
                      "text": ""
                    }
                  ]
                }
              ]
            },
            {
              "type": "diff-block",
              "file": "package.json",
              "commit": "796276585cc5686c3d29a705e90af08df6c04101",
              "hiddenLines": [],
              "children": [
                {
                  "text": ""
                }
              ]
            },
            {
              "type": "explain",
              "fixed": true,
              "children": [
                {
                  "type": "paragraph",
                  "children": [
                    {
                      "text": ""
                    }
                  ]
                }
              ]
            }
          ]
        },
        {
          "type": "file",
          "file": "public/favicon.ico",
          "display": true,
          "children": [
            {
              "type": "explain",
              "fixed": true,
              "children": [
                {
                  "type": "paragraph",
                  "children": [
                    {
                      "text": ""
                    }
                  ]
                }
              ]
            },
            {
              "type": "diff-block",
              "file": "public/favicon.ico",
              "commit": "796276585cc5686c3d29a705e90af08df6c04101",
              "hiddenLines": [],
              "children": [
                {
                  "text": ""
                }
              ]
            },
            {
              "type": "explain",
              "fixed": true,
              "children": [
                {
                  "type": "paragraph",
                  "children": [
                    {
                      "text": ""
                    }
                  ]
                }
              ]
            }
          ]
        },
        {
          "type": "file",
          "file": "public/index.html",
          "display": true,
          "children": [
            {
              "type": "explain",
              "fixed": true,
              "children": [
                {
                  "type": "paragraph",
                  "children": [
                    {
                      "text": ""
                    }
                  ]
                }
              ]
            },
            {
              "type": "diff-block",
              "file": "public/index.html",
              "commit": "796276585cc5686c3d29a705e90af08df6c04101",
              "hiddenLines": [],
              "children": [
                {
                  "text": ""
                }
              ]
            },
            {
              "type": "explain",
              "fixed": true,
              "children": [
                {
                  "type": "paragraph",
                  "children": [
                    {
                      "text": ""
                    }
                  ]
                }
              ]
            }
          ]
        },
        {
          "type": "file",
          "file": "public/logo192.png",
          "display": true,
          "children": [
            {
              "type": "explain",
              "fixed": true,
              "children": [
                {
                  "type": "paragraph",
                  "children": [
                    {
                      "text": ""
                    }
                  ]
                }
              ]
            },
            {
              "type": "diff-block",
              "file": "public/logo192.png",
              "commit": "796276585cc5686c3d29a705e90af08df6c04101",
              "hiddenLines": [],
              "children": [
                {
                  "text": ""
                }
              ]
            },
            {
              "type": "explain",
              "fixed": true,
              "children": [
                {
                  "type": "paragraph",
                  "children": [
                    {
                      "text": ""
                    }
                  ]
                }
              ]
            }
          ]
        },
        {
          "type": "file",
          "file": "public/logo512.png",
          "display": true,
          "children": [
            {
              "type": "explain",
              "fixed": true,
              "children": [
                {
                  "type": "paragraph",
                  "children": [
                    {
                      "text": ""
                    }
                  ]
                }
              ]
            },
            {
              "type": "diff-block",
              "file": "public/logo512.png",
              "commit": "796276585cc5686c3d29a705e90af08df6c04101",
              "hiddenLines": [],
              "children": [
                {
                  "text": ""
                }
              ]
            },
            {
              "type": "explain",
              "fixed": true,
              "children": [
                {
                  "type": "paragraph",
                  "children": [
                    {
                      "text": ""
                    }
                  ]
                }
              ]
            }
          ]
        },
        {
          "type": "file",
          "file": "public/manifest.json",
          "display": true,
          "children": [
            {
              "type": "explain",
              "fixed": true,
              "children": [
                {
                  "type": "paragraph",
                  "children": [
                    {
                      "text": ""
                    }
                  ]
                }
              ]
            },
            {
              "type": "diff-block",
              "file": "public/manifest.json",
              "commit": "796276585cc5686c3d29a705e90af08df6c04101",
              "hiddenLines": [],
              "children": [
                {
                  "text": ""
                }
              ]
            },
            {
              "type": "explain",
              "fixed": true,
              "children": [
                {
                  "type": "paragraph",
                  "children": [
                    {
                      "text": ""
                    }
                  ]
                }
              ]
            }
          ]
        },
        {
          "type": "file",
          "file": "public/robots.txt",
          "display": true,
          "children": [
            {
              "type": "explain",
              "fixed": true,
              "children": [
                {
                  "type": "paragraph",
                  "children": [
                    {
                      "text": ""
                    }
                  ]
                }
              ]
            },
            {
              "type": "diff-block",
              "file": "public/robots.txt",
              "commit": "796276585cc5686c3d29a705e90af08df6c04101",
              "hiddenLines": [],
              "children": [
                {
                  "text": ""
                }
              ]
            },
            {
              "type": "explain",
              "fixed": true,
              "children": [
                {
                  "type": "paragraph",
                  "children": [
                    {
                      "text": ""
                    }
                  ]
                }
              ]
            }
          ]
        },
        {
          "type": "explain",
          "fixed": true,
          "children": [
            {
              "type": "paragraph",
              "children": [
                {
                  "text": ""
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "commit": "0b710d1d9ed03c4663748ccc10b337a11bccab3f",
      "id": "230ba65c",
      "articleId": "5e1396b8",
      "type": "step",
      "children": [
        {
          "type": "heading-two",
          "commit": "0b710d1d9ed03c4663748ccc10b337a11bccab3f",
          "id": "35dbfadc",
          "fixed": true,
          "children": [
            {
              "text": "初识 Jest 单元测试"
            }
          ]
        },
        {
          "type": "explain",
          "fixed": true,
          "children": [
            {
              "type": "paragraph",
              "children": [
                {
                  "text": "测试是检查代码的代码，能够大大增强我们对应用的信心。更重要的是，测试会阻止你在修复一件事情的同时破坏另一件事情，让我们能够放开手脚进行功能的添加与大规模重构。您可以测试应用程序的许多方面，从单个函数及其返回值到在浏览器中运行的复杂应用程序。万丈高楼平地起，让我们先来了解一下有哪些测试。"
                }
              ]
            },
            {
              "type": "heading-three",
              "children": [
                {
                  "text": "测试的类型"
                }
              ],
              "id": "MXvONvusW"
            },
            {
              "type": "heading-four",
              "children": [
                {
                  "text": "单元测试"
                }
              ],
              "id": "3Yi38H9mM"
            },
            {
              "type": "paragraph",
              "children": [
                {
                  "text": "单元测试的目标可以是一个函数，一个类，或者一个模块。单元测试应该是相互隔离和独立的。对于给定的输入，单元测试检查结果。通过及早发现问题并避免 bug 回归，它可以帮助我们确保代码的各个部分按预期工作。"
                }
              ]
            },
            {
              "type": "heading-four",
              "children": [
                {
                  "text": "集成测试"
                }
              ],
              "id": "9y6jGT6T8"
            },
            {
              "type": "paragraph",
              "children": [
                {
                  "text": "即使所有单元测试都通过了，我们的应用仍然可能会崩溃。集成测试则是用来测试跨模单元/模块的过程，可以很好地确保我们的代码能够作为一个整体运行。"
                }
              ]
            },
            {
              "type": "heading-four",
              "children": [
                {
                  "text": "端到端测试(E2E)"
                }
              ],
              "id": "4CcyiHQXu"
            },
            {
              "type": "paragraph",
              "children": [
                {
                  "text": "与其他类型的测试不同，E2E 测试总是在浏览器(或类浏览器)环境中运行。它可能是一个实际的浏览器，可以打开并在其中运行测试；也可能是一个无头（Headless）的浏览器环境，这是一个没有用户界面的浏览器。E2E 测试的重点是在我们正在运行的应用程序中模拟实际用户（例如模拟滚动、单击和键入等行为），并检查我们的应用程序是否从实际用户的角度运行良好。"
                }
              ]
            },
            {
              "type": "paragraph",
              "children": [
                {
                  "text": "在这一系列教程中，我们将会从零开始，一步步带你熟悉从单元测试到端到端测试的方方面面。我们将会在一个 React 项目中实践所学到的自动化测试技术。首先用 Create React App（CRA）搭建项目脚手架："
                }
              ]
            },
            {
              "type": "code-block",
              "lang": "bash",
              "children": [
                {
                  "type": "code-line",
                  "children": [
                    {
                      "text": "create-react-app javascript-test-series"
                    }
                  ]
                }
              ]
            },
            {
              "type": "paragraph",
              "children": [
                {
                  "text": "然后我们删除 "
                },
                {
                  "text": "src",
                  "code": true
                },
                {
                  "text": " 目录下所有预创建的文件（当然你也可以手动删除）："
                }
              ]
            },
            {
              "type": "code-block",
              "lang": "bash",
              "children": [
                {
                  "type": "code-line",
                  "children": [
                    {
                      "text": "rm src/*"
                    }
                  ]
                }
              ]
            },
            {
              "type": "paragraph",
              "children": [
                {
                  "text": "一切准备就绪！让我们开始吧。"
                }
              ]
            }
          ]
        },
        {
          "file": "divide.js",
          "display": true,
          "commit": "0b710d1d9ed03c4663748ccc10b337a11bccab3f",
          "type": "file",
          "children": [
            {
              "type": "explain",
              "fixed": true,
              "children": [
                {
                  "type": "heading-three",
                  "children": [
                    {
                      "text": "编写第一个单元测试"
                    }
                  ],
                  "id": "57wUntp3Z"
                },
                {
                  "type": "paragraph",
                  "children": [
                    {
                      "text": "编写一个单元测试实际上要比你想象得简单很多。首先创建 "
                    },
                    {
                      "text": "divide.js",
                      "code": true
                    },
                    {
                      "text": " ，在其中编写一个 "
                    },
                    {
                      "text": "divide",
                      "code": true
                    },
                    {
                      "text": " 函数："
                    }
                  ]
                }
              ]
            },
            {
              "type": "diff-block",
              "file": "divide.js",
              "commit": "0b710d1d9ed03c4663748ccc10b337a11bccab3f",
              "hiddenLines": [],
              "children": [
                {
                  "text": ""
                }
              ]
            },
            {
              "type": "explain",
              "fixed": true,
              "children": [
                {
                  "type": "paragraph",
                  "children": [
                    {
                      "text": ""
                    }
                  ]
                }
              ]
            }
          ]
        },
        {
          "file": "divide.test.js",
          "display": true,
          "commit": "0b710d1d9ed03c4663748ccc10b337a11bccab3f",
          "type": "file",
          "children": [
            {
              "type": "explain",
              "fixed": true,
              "children": [
                {
                  "type": "paragraph",
                  "children": [
                    {
                      "text": "然后创建测试文件 "
                    },
                    {
                      "text": "divide.test.js",
                      "code": true
                    },
                    {
                      "text": " ，代码如下："
                    }
                  ]
                }
              ]
            },
            {
              "type": "diff-block",
              "file": "divide.test.js",
              "commit": "0b710d1d9ed03c4663748ccc10b337a11bccab3f",
              "hiddenLines": [],
              "children": [
                {
                  "text": ""
                }
              ]
            },
            {
              "type": "explain",
              "fixed": true,
              "children": [
                {
                  "type": "paragraph",
                  "children": [
                    {
                      "text": "作为本系列教程的第一个 Jest 测试，我们来详细讲解一下："
                    }
                  ]
                },
                {
                  "type": "bulleted-list",
                  "children": [
                    {
                      "type": "list-item",
                      "children": [
                        {
                          "text": "我们先导入需要测试的单元/模块"
                        }
                      ],
                      "level": 0,
                      "parent": "bulleted-list"
                    },
                    {
                      "type": "list-item",
                      "children": [
                        {
                          "text": "test",
                          "code": true
                        },
                        {
                          "text": " 函数定义了一个"
                        },
                        {
                          "text": "测试用例",
                          "bold": true
                        },
                        {
                          "text": "，第一个参数就是"
                        },
                        {
                          "text": "用例描述",
                          "bold": true
                        },
                        {
                          "text": "，一般是一句完整的描述，例如上面的 "
                        },
                        {
                          "text": "dividing 6 by 3 equals 2",
                          "code": true
                        },
                        {
                          "text": " ；第二个参数则是一个待执行的"
                        },
                        {
                          "text": "测试函数",
                          "bold": true
                        }
                      ],
                      "level": 0,
                      "parent": "bulleted-list"
                    },
                    {
                      "type": "list-item",
                      "children": [
                        {
                          "text": "在测试函数中，最重要的组成部分就是"
                        },
                        {
                          "text": "断言",
                          "bold": true
                        },
                        {
                          "text": "（Assertion），例如上面的 "
                        },
                        {
                          "text": "expect(divide(6, 3)).toBe(2)",
                          "code": true
                        },
                        {
                          "text": " "
                        }
                      ],
                      "level": 0,
                      "parent": "bulleted-list"
                    },
                    {
                      "type": "list-item",
                      "children": [
                        {
                          "text": "断言的核心是 "
                        },
                        {
                          "text": "expect",
                          "code": true
                        },
                        {
                          "text": " 函数，它接受一个表达式，然后后面可以调用 Matcher 来测试该表达式是否符合条件，例如这里我们就使用了最常用的 "
                        },
                        {
                          "text": "toBe",
                          "code": true
                        },
                        {
                          "text": " Matcher；Jest 还提供了大量的 Matcher，可以帮助我们写出更简洁可读的断言语句，可参考 "
                        },
                        {
                          "text": "Expect API",
                          "link": true,
                          "url": "https://jestjs.io/docs/zh-Hans/expect"
                        }
                      ],
                      "level": 0,
                      "parent": "bulleted-list"
                    }
                  ]
                },
                {
                  "type": "paragraph",
                  "children": [
                    {
                      "text": "CRA 已经为我们配置好了 Jest，这里直接运行 "
                    },
                    {
                      "text": "npx jest",
                      "code": true
                    },
                    {
                      "text": " 命令，就可以看到测试结果了："
                    }
                  ]
                },
                {
                  "type": "code-block",
                  "lang": "",
                  "children": [
                    {
                      "type": "code-line",
                      "children": [
                        {
                          "text": "PASS  ./divide.test.js"
                        }
                      ]
                    },
                    {
                      "type": "code-line",
                      "children": [
                        {
                          "text": "  ✓ dividing 6 by 3 equals 2 (5ms)"
                        }
                      ]
                    }
                  ]
                },
                {
                  "type": "note",
                  "level": "info",
                  "children": [
                    {
                      "type": "paragraph",
                      "children": [
                        {
                          "text": "CRA 也配置了 "
                        },
                        {
                          "text": "test",
                          "code": true
                        },
                        {
                          "text": " 命令，但是提供了比较复杂的功能配置（例如 Watch 模式等），可能会让初学 Jest 的你不知所措。因此这里建议直接使用 "
                        },
                        {
                          "text": "npx jest",
                          "code": true
                        },
                        {
                          "text": " 执行测试。"
                        }
                      ]
                    }
                  ]
                }
              ]
            }
          ]
        },
        {
          "file": "package.json",
          "display": false,
          "commit": "0b710d1d9ed03c4663748ccc10b337a11bccab3f",
          "type": "file",
          "children": [
            {
              "type": "explain",
              "fixed": true,
              "children": [
                {
                  "type": "paragraph",
                  "children": [
                    {
                      "text": ""
                    }
                  ]
                }
              ]
            },
            {
              "type": "diff-block",
              "file": "package.json",
              "commit": "0b710d1d9ed03c4663748ccc10b337a11bccab3f",
              "hiddenLines": [
                [
                  1,
                  11
                ],
                [
                  19,
                  33
                ]
              ],
              "children": [
                {
                  "text": ""
                }
              ]
            },
            {
              "type": "explain",
              "fixed": true,
              "children": [
                {
                  "type": "paragraph",
                  "children": [
                    {
                      "text": ""
                    }
                  ]
                }
              ]
            }
          ]
        },
        {
          "file": "math.test.js",
          "display": true,
          "commit": "0b710d1d9ed03c4663748ccc10b337a11bccab3f",
          "type": "file",
          "children": [
            {
              "type": "explain",
              "fixed": true,
              "children": [
                {
                  "type": "heading-three",
                  "children": [
                    {
                      "text": "编写第一组测试"
                    }
                  ],
                  "id": "TL84IpcI4"
                },
                {
                  "type": "paragraph",
                  "children": [
                    {
                      "text": "每个测试文件通常有多个测试用例。Jest 允许我们通过 "
                    },
                    {
                      "text": "describe",
                      "code": true
                    },
                    {
                      "text": " 函数对测试用例进行分组，它创建了一个可以组合多个测试的块。让我们对全局 "
                    },
                    {
                      "text": "Math",
                      "code": true
                    },
                    {
                      "text": " 对象运行一些测试（希望浏览器工程师和 Node 开源项目维护者不要来打我），创建 "
                    },
                    {
                      "text": "math.test.js",
                      "code": true
                    },
                    {
                      "text": " ，代码如下："
                    }
                  ]
                }
              ]
            },
            {
              "type": "diff-block",
              "file": "math.test.js",
              "commit": "0b710d1d9ed03c4663748ccc10b337a11bccab3f",
              "hiddenLines": [],
              "children": [
                {
                  "text": ""
                }
              ]
            },
            {
              "type": "explain",
              "fixed": true,
              "children": [
                {
                  "type": "block-quote",
                  "children": [
                    {
                      "type": "paragraph",
                      "children": [
                        {
                          "text": "你也许注意到了这里我们用了 "
                        },
                        {
                          "text": "it",
                          "code": true
                        },
                        {
                          "text": " 函数而不是 "
                        },
                        {
                          "text": "test",
                          "code": true
                        },
                        {
                          "text": " 函数，这两者实际上是完全一样的。"
                        }
                      ]
                    }
                  ]
                },
                {
                  "type": "paragraph",
                  "children": [
                    {
                      "text": "这样对测试进行分组可以使我们的代码更加清晰。在关注应用程序的代码质量的同时，我们也应该确保测试代码的质量，这样我们才有足够的动力不断去维护测试代码，从而确保我们的项目能够保持健壮。"
                    }
                  ]
                },
                {
                  "type": "paragraph",
                  "children": [
                    {
                      "text": "除了使代码更具可读性之外，它还有助于在出现错误时提供更好的错误消息。如果这里我们将第一条测试用例改为 "
                    },
                    {
                      "text": "expect(typeof Math.random()).toEqual('string')",
                      "code": true
                    },
                    {
                      "text": " ，那么再运行 "
                    },
                    {
                      "text": "npx jest",
                      "code": true
                    },
                    {
                      "text": " ，就会出现如下错误信息："
                    }
                  ]
                },
                {
                  "type": "code-block",
                  "lang": "",
                  "children": [
                    {
                      "type": "code-line",
                      "children": [
                        {
                          "text": "FAIL  ./math.test.js"
                        }
                      ]
                    },
                    {
                      "type": "code-line",
                      "children": [
                        {
                          "text": "  ● in the math global object › the random function › should return a number"
                        }
                      ]
                    },
                    {
                      "type": "code-line",
                      "children": [
                        {
                          "text": ""
                        }
                      ]
                    },
                    {
                      "type": "code-line",
                      "children": [
                        {
                          "text": "    expect(received).toEqual(expected)"
                        }
                      ]
                    },
                    {
                      "type": "code-line",
                      "children": [
                        {
                          "text": ""
                        }
                      ]
                    },
                    {
                      "type": "code-line",
                      "children": [
                        {
                          "text": "    Expected value to equal:"
                        }
                      ]
                    },
                    {
                      "type": "code-line",
                      "children": [
                        {
                          "text": "      \"string\""
                        }
                      ]
                    },
                    {
                      "type": "code-line",
                      "children": [
                        {
                          "text": "    Received:"
                        }
                      ]
                    },
                    {
                      "type": "code-line",
                      "children": [
                        {
                          "text": "      \"number\""
                        }
                      ]
                    }
                  ]
                },
                {
                  "type": "paragraph",
                  "children": [
                    {
                      "text": "是不是一目了然呢？"
                    }
                  ]
                }
              ]
            }
          ]
        },
        {
          "type": "explain",
          "fixed": true,
          "children": [
            {
              "type": "heading-three",
              "children": [
                {
                  "text": "小结"
                }
              ],
              "id": "14zX4UIF3"
            },
            {
              "type": "paragraph",
              "children": [
                {
                  "text": "在这一小节中，我们首先了解了测试有哪些类型。然后我们在 CRA 脚手架中编写了一个简单的函数，并为之编写了第一个单元测试，熟悉了测试用例、断言、Matcher 这些关键概念，并成功地通过了测试。接着，我们又编写了一个包含多个用例的测试文件，并通过 "
                },
                {
                  "text": "describe",
                  "code": true
                },
                {
                  "text": " 函数将测试用例组织得井井有条。"
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "commit": "9fd76e23ae77dd7c2f4811ae32c17a03256d9c21",
      "id": "c99d23be",
      "articleId": "5e1396b8",
      "type": "step",
      "children": [
        {
          "type": "heading-two",
          "commit": "9fd76e23ae77dd7c2f4811ae32c17a03256d9c21",
          "id": "81bd1efb",
          "fixed": true,
          "children": [
            {
              "text": "初识 Enzyme：编写第一个  React 组件测试"
            }
          ]
        },
        {
          "type": "explain",
          "fixed": true,
          "children": [
            {
              "type": "paragraph",
              "children": [
                {
                  "text": "很显然，我们不会仅仅满足于测试像 "
                },
                {
                  "text": "divide",
                  "code": true
                },
                {
                  "text": " 那样简单的函数，我们希望能够测试一个 React 组件，但是和一个普通的 JavaScript 函数不同，测试一个 React 组件还需要两个关键的问题：1）怎么渲染待测试的组件；2）怎么测试渲染出来的组件。 "
                }
              ]
            },
            {
              "type": "paragraph",
              "children": [
                {
                  "text": "所幸的是，Airbnb 作为重度使用 React 的先驱，早就提出了专门的解决方案："
                },
                {
                  "text": "Enzyme",
                  "link": true,
                  "url": "https://github.com/enzymejs/enzyme"
                },
                {
                  "text": "。"
                }
              ]
            },
            {
              "type": "heading-three",
              "children": [
                {
                  "text": "安装和配置 Enzyme"
                }
              ]
            },
            {
              "type": "paragraph",
              "children": [
                {
                  "text": "首先安装 Enzyme 和相应的 React 适配器："
                }
              ]
            },
            {
              "type": "code-block",
              "lang": "bash",
              "children": [
                {
                  "type": "code-line",
                  "children": [
                    {
                      "text": "npm install enzyme enzyme-adapter-react-16"
                    }
                  ]
                }
              ]
            }
          ]
        },
        {
          "file": "package-lock.json",
          "display": false,
          "commit": "9fd76e23ae77dd7c2f4811ae32c17a03256d9c21",
          "type": "file",
          "children": [
            {
              "type": "explain",
              "fixed": true,
              "children": [
                {
                  "type": "paragraph",
                  "children": [
                    {
                      "text": ""
                    }
                  ]
                }
              ]
            },
            {
              "type": "diff-block",
              "file": "package-lock.json",
              "commit": "9fd76e23ae77dd7c2f4811ae32c17a03256d9c21",
              "hiddenLines": [
                [
                  0,
                  2204
                ],
                [
                  2227,
                  2340
                ],
                [
                  2352,
                  2378
                ],
                [
                  2394,
                  3427
                ],
                [
                  3496,
                  4589
                ],
                [
                  4601,
                  4866
                ],
                [
                  4954,
                  6221
                ],
                [
                  6248,
                  6572
                ],
                [
                  6587,
                  6987
                ],
                [
                  6999,
                  7099
                ],
                [
                  7111,
                  7176
                ],
                [
                  7188,
                  8132
                ],
                [
                  8154,
                  8559
                ],
                [
                  8571,
                  8637
                ],
                [
                  8663,
                  10423
                ],
                [
                  10440,
                  10549
                ],
                [
                  10570,
                  10908
                ],
                [
                  10926,
                  10981
                ],
                [
                  10993,
                  11363
                ],
                [
                  11379,
                  12262
                ]
              ],
              "children": [
                {
                  "text": ""
                }
              ]
            },
            {
              "type": "explain",
              "fixed": true,
              "children": [
                {
                  "type": "paragraph",
                  "children": [
                    {
                      "text": ""
                    }
                  ]
                }
              ]
            }
          ]
        },
        {
          "file": "package.json",
          "display": false,
          "commit": "9fd76e23ae77dd7c2f4811ae32c17a03256d9c21",
          "type": "file",
          "children": [
            {
              "type": "explain",
              "fixed": true,
              "children": [
                {
                  "type": "paragraph",
                  "children": [
                    {
                      "text": ""
                    }
                  ]
                }
              ]
            },
            {
              "type": "diff-block",
              "file": "package.json",
              "commit": "9fd76e23ae77dd7c2f4811ae32c17a03256d9c21",
              "hiddenLines": [
                [
                  0,
                  4
                ],
                [
                  13,
                  13
                ]
              ],
              "children": [
                {
                  "text": ""
                }
              ]
            },
            {
              "type": "explain",
              "fixed": true,
              "children": [
                {
                  "type": "paragraph",
                  "children": [
                    {
                      "text": ""
                    }
                  ]
                }
              ]
            }
          ]
        },
        {
          "file": "src/setupTests.js",
          "display": true,
          "commit": "9fd76e23ae77dd7c2f4811ae32c17a03256d9c21",
          "type": "file",
          "children": [
            {
              "type": "explain",
              "fixed": true,
              "children": [
                {
                  "type": "paragraph",
                  "children": [
                    {
                      "text": "我们需要配置一下 Enzyme，才能在 Jest 测试文件中使用它。创建 "
                    },
                    {
                      "text": "src/setupTests.js",
                      "code": true
                    },
                    {
                      "text": " ，代码如下："
                    }
                  ]
                }
              ]
            },
            {
              "type": "diff-block",
              "file": "src/setupTests.js",
              "commit": "9fd76e23ae77dd7c2f4811ae32c17a03256d9c21",
              "hiddenLines": [],
              "children": [
                {
                  "text": ""
                }
              ]
            },
            {
              "type": "explain",
              "fixed": true,
              "children": [
                {
                  "type": "paragraph",
                  "children": [
                    {
                      "text": ""
                    }
                  ]
                }
              ]
            }
          ]
        },
        {
          "file": "src/App.js",
          "display": true,
          "commit": "9fd76e23ae77dd7c2f4811ae32c17a03256d9c21",
          "type": "file",
          "children": [
            {
              "type": "explain",
              "fixed": true,
              "children": [
                {
                  "type": "heading-three",
                  "children": [
                    {
                      "text": "浅层渲染"
                    }
                  ]
                },
                {
                  "type": "paragraph",
                  "children": [
                    {
                      "text": "Enzyme 提供的一个重要功能便是组件的"
                    },
                    {
                      "text": "浅层渲染",
                      "bold": true
                    },
                    {
                      "text": "（Shallow Rendering）。它允许我们在运行测试时，"
                    },
                    {
                      "text": "只渲染父组件而不渲染其所有的子组件",
                      "bold": true
                    },
                    {
                      "text": "。浅层渲染十分快速，因此非常适合单元测试。"
                    }
                  ]
                },
                {
                  "type": "paragraph",
                  "children": [
                    {
                      "text": "首先让我们创建一个简单的 React 组件，创建 "
                    },
                    {
                      "text": "src/App.js",
                      "code": true
                    },
                    {
                      "text": " ，代码如下："
                    }
                  ]
                }
              ]
            },
            {
              "type": "diff-block",
              "file": "src/App.js",
              "commit": "9fd76e23ae77dd7c2f4811ae32c17a03256d9c21",
              "hiddenLines": [],
              "children": [
                {
                  "text": ""
                }
              ]
            },
            {
              "type": "explain",
              "fixed": true,
              "children": [
                {
                  "type": "paragraph",
                  "children": [
                    {
                      "text": ""
                    }
                  ]
                }
              ]
            }
          ]
        },
        {
          "file": "src/App.test.js",
          "display": true,
          "commit": "9fd76e23ae77dd7c2f4811ae32c17a03256d9c21",
          "type": "file",
          "children": [
            {
              "type": "explain",
              "fixed": true,
              "children": [
                {
                  "type": "paragraph",
                  "children": [
                    {
                      "text": "编写 "
                    },
                    {
                      "text": "App",
                      "code": true
                    },
                    {
                      "text": " 组件对应的测试文件 "
                    },
                    {
                      "text": "src/App.test.js",
                      "code": true
                    },
                    {
                      "text": " ，代码如下："
                    }
                  ]
                }
              ]
            },
            {
              "type": "diff-block",
              "file": "src/App.test.js",
              "commit": "9fd76e23ae77dd7c2f4811ae32c17a03256d9c21",
              "hiddenLines": [],
              "children": [
                {
                  "text": ""
                }
              ]
            },
            {
              "type": "explain",
              "fixed": true,
              "children": [
                {
                  "type": "paragraph",
                  "children": [
                    {
                      "text": "可以看到，这里我们用 "
                    },
                    {
                      "text": "shallow",
                      "code": true
                    },
                    {
                      "text": " 函数来浅层渲染 "
                    },
                    {
                      "text": "App",
                      "code": true
                    },
                    {
                      "text": " 组件得到 "
                    },
                    {
                      "text": "app",
                      "code": true
                    },
                    {
                      "text": " ，并且调用其 "
                    },
                    {
                      "text": "containsMatchingElement",
                      "code": true
                    },
                    {
                      "text": " 来判断渲染后的 "
                    },
                    {
                      "text": "App",
                      "code": true
                    },
                    {
                      "text": " 组件是否包含 "
                    },
                    {
                      "text": "<h1>Hello world!</h1>",
                      "code": true
                    },
                    {
                      "text": " 元素。"
                    }
                  ]
                },
                {
                  "type": "block-quote",
                  "children": [
                    {
                      "type": "paragraph",
                      "children": [
                        {
                          "text": "Enzyme 浅层渲染后的组件还包括其他测试方法，可参考 "
                        },
                        {
                          "text": "https://enzymejs.github.io/enzyme/docs/api/shallow.html",
                          "link": true,
                          "url": "https://enzymejs.github.io/enzyme/docs/api/shallow.html"
                        },
                        {
                          "text": "。"
                        }
                      ]
                    }
                  ]
                }
              ]
            }
          ]
        },
        {
          "type": "explain",
          "fixed": true,
          "children": [
            {
              "type": "paragraph",
              "children": [
                {
                  "text": "通过 "
                },
                {
                  "text": "npm test",
                  "code": true
                },
                {
                  "text": " 命令，我们就可以看到刚才的测试通过了："
                }
              ]
            },
            {
              "type": "code-block",
              "lang": "",
              "children": [
                {
                  "type": "code-line",
                  "children": [
                    {
                      "text": "PASS  app/App.test.js"
                    }
                  ]
                },
                {
                  "type": "code-line",
                  "children": [
                    {
                      "text": "  app component"
                    }
                  ]
                },
                {
                  "type": "code-line",
                  "children": [
                    {
                      "text": "    ✓ contains a header with the \"Hello world!\""
                    }
                  ]
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "commit": "2ee6b58449f7570a465b349455186e5916058080",
      "id": "5534ea3a",
      "articleId": "5e1396b8",
      "type": "step",
      "children": [
        {
          "type": "heading-two",
          "commit": "2ee6b58449f7570a465b349455186e5916058080",
          "id": "574aad07",
          "fixed": true,
          "children": [
            {
              "text": "测试更复杂的组件"
            }
          ]
        },
        {
          "type": "explain",
          "fixed": true,
          "children": [
            {
              "type": "paragraph",
              "children": [
                {
                  "text": "在实际的前端开发中，我们的组件要复杂很多。本着循序渐进的原则，我们稍微前进一步：来编写一个接受 "
                },
                {
                  "text": "props",
                  "code": true
                },
                {
                  "text": " 的组件，并根据数据来决定渲染结果。"
                }
              ]
            }
          ]
        },
        {
          "file": "package-lock.json",
          "display": false,
          "commit": "2ee6b58449f7570a465b349455186e5916058080",
          "type": "file",
          "children": [
            {
              "type": "explain",
              "fixed": true,
              "children": [
                {
                  "type": "paragraph",
                  "children": [
                    {
                      "text": ""
                    }
                  ]
                }
              ]
            },
            {
              "type": "diff-block",
              "file": "package-lock.json",
              "commit": "2ee6b58449f7570a465b349455186e5916058080",
              "hiddenLines": [
                [
                  0,
                  3576
                ],
                [
                  3588,
                  4396
                ],
                [
                  4422,
                  4962
                ],
                [
                  4978,
                  4980
                ],
                [
                  4996,
                  7436
                ],
                [
                  7451,
                  7545
                ],
                [
                  7562,
                  8187
                ],
                [
                  8214,
                  8222
                ]
              ],
              "children": [
                {
                  "text": ""
                }
              ]
            },
            {
              "type": "explain",
              "fixed": true,
              "children": [
                {
                  "type": "paragraph",
                  "children": [
                    {
                      "text": ""
                    }
                  ]
                }
              ]
            }
          ]
        },
        {
          "file": "package.json",
          "display": false,
          "commit": "2ee6b58449f7570a465b349455186e5916058080",
          "type": "file",
          "children": [
            {
              "type": "explain",
              "fixed": true,
              "children": [
                {
                  "type": "paragraph",
                  "children": [
                    {
                      "text": ""
                    }
                  ]
                }
              ]
            },
            {
              "type": "diff-block",
              "file": "package.json",
              "commit": "2ee6b58449f7570a465b349455186e5916058080",
              "hiddenLines": [
                [
                  0,
                  6
                ]
              ],
              "children": [
                {
                  "text": ""
                }
              ]
            },
            {
              "type": "explain",
              "fixed": true,
              "children": [
                {
                  "type": "paragraph",
                  "children": [
                    {
                      "text": ""
                    }
                  ]
                }
              ]
            }
          ]
        },
        {
          "file": "src/setupTests.js",
          "display": true,
          "commit": "2ee6b58449f7570a465b349455186e5916058080",
          "type": "file",
          "children": [
            {
              "type": "explain",
              "fixed": true,
              "children": [
                {
                  "type": "heading-three",
                  "children": [
                    {
                      "text": "配置 jest-enzyme"
                    }
                  ],
                  "id": "IG9G8vHW6"
                },
                {
                  "type": "paragraph",
                  "children": [
                    {
                      "text": "你应该还记得，在刚才的测试代码中，我们还是使用了 Jest 自带的 Matcher（"
                    },
                    {
                      "text": "toEqual",
                      "code": true
                    },
                    {
                      "text": "）。但实际上，社区还提供了更好的选择——专门为 Enzyme 定制的 Matcher 库："
                    },
                    {
                      "text": "enzyme-matchers",
                      "link": true,
                      "url": "https://github.com/FormidableLabs/enzyme-matchers"
                    },
                    {
                      "text": "。这些 Matcher 使得编写断言语句更轻松、更具可读性。"
                    }
                  ]
                },
                {
                  "type": "paragraph",
                  "children": [
                    {
                      "text": "我们通过 npm 来安装 jest-enzyme："
                    }
                  ]
                },
                {
                  "type": "code-block",
                  "lang": "bash",
                  "children": [
                    {
                      "type": "code-line",
                      "children": [
                        {
                          "text": "npm install jest-enzyme"
                        }
                      ]
                    }
                  ]
                },
                {
                  "type": "paragraph",
                  "children": [
                    {
                      "text": "相应地在 "
                    },
                    {
                      "text": "src/setupTests.js",
                      "code": true
                    },
                    {
                      "text": " 中添加相应的配置："
                    }
                  ]
                }
              ]
            },
            {
              "type": "diff-block",
              "file": "src/setupTests.js",
              "commit": "2ee6b58449f7570a465b349455186e5916058080",
              "hiddenLines": [],
              "children": [
                {
                  "text": ""
                }
              ]
            },
            {
              "type": "explain",
              "fixed": true,
              "children": [
                {
                  "type": "paragraph",
                  "children": [
                    {
                      "text": ""
                    }
                  ]
                }
              ]
            }
          ]
        },
        {
          "file": "src/TodoList.js",
          "display": true,
          "commit": "2ee6b58449f7570a465b349455186e5916058080",
          "type": "file",
          "children": [
            {
              "type": "explain",
              "fixed": true,
              "children": [
                {
                  "type": "heading-three",
                  "children": [
                    {
                      "text": "编写 TodoList 组件"
                    }
                  ],
                  "id": "zQMvmKHW1"
                },
                {
                  "type": "paragraph",
                  "children": [
                    {
                      "text": "这次，我们还是编写一个熟悉的 "
                    },
                    {
                      "text": "TodoList",
                      "code": true
                    },
                    {
                      "text": " 组件。创建 "
                    },
                    {
                      "text": "src/TodoList.js",
                      "code": true
                    },
                    {
                      "text": " ，代码如下："
                    }
                  ]
                }
              ]
            },
            {
              "type": "diff-block",
              "file": "src/TodoList.js",
              "commit": "2ee6b58449f7570a465b349455186e5916058080",
              "hiddenLines": [],
              "children": [
                {
                  "text": ""
                }
              ]
            },
            {
              "type": "explain",
              "fixed": true,
              "children": [
                {
                  "type": "paragraph",
                  "children": [
                    {
                      "text": "可以看到，这个组件接受一个 "
                    },
                    {
                      "text": "tasks",
                      "code": true
                    },
                    {
                      "text": " 数组，并将其渲染成一个列表。"
                    }
                  ]
                }
              ]
            }
          ]
        },
        {
          "file": "src/TodoList.test.js",
          "display": true,
          "commit": "2ee6b58449f7570a465b349455186e5916058080",
          "type": "file",
          "children": [
            {
              "type": "explain",
              "fixed": true,
              "children": [
                {
                  "type": "heading-three",
                  "children": [
                    {
                      "text": "编写 TodoList 组件测试"
                    }
                  ],
                  "id": "_iHe8QxJJ"
                },
                {
                  "type": "paragraph",
                  "children": [
                    {
                      "text": "先思考一下，如果要测试上面的 "
                    },
                    {
                      "text": "TodoList",
                      "code": true
                    },
                    {
                      "text": " 组件，要考虑哪些情况？不难想到主要是两种情况："
                    }
                  ]
                },
                {
                  "type": "bulleted-list",
                  "children": [
                    {
                      "type": "list-item",
                      "children": [
                        {
                          "text": "传入的 "
                        },
                        {
                          "text": "tasks",
                          "code": true
                        },
                        {
                          "text": " 数组为空"
                        }
                      ],
                      "level": 0,
                      "parent": "bulleted-list"
                    },
                    {
                      "type": "list-item",
                      "children": [
                        {
                          "text": "传入的 "
                        },
                        {
                          "text": "tasks",
                          "code": true
                        },
                        {
                          "text": " 数组不为空"
                        }
                      ],
                      "level": 0,
                      "parent": "bulleted-list"
                    }
                  ]
                },
                {
                  "type": "paragraph",
                  "children": [
                    {
                      "text": "对应这两种情况，我们开始编写测试。创建 "
                    },
                    {
                      "text": "src/TodoList.test.js",
                      "code": true
                    },
                    {
                      "text": " ，代码如下："
                    }
                  ]
                }
              ]
            },
            {
              "type": "diff-block",
              "file": "src/TodoList.test.js",
              "commit": "2ee6b58449f7570a465b349455186e5916058080",
              "hiddenLines": [],
              "children": [
                {
                  "text": ""
                }
              ]
            },
            {
              "type": "explain",
              "fixed": true,
              "children": [
                {
                  "type": "paragraph",
                  "children": [
                    {
                      "text": "可以看到在第一个测试用例中，我们使用了 "
                    },
                    {
                      "text": "toContainReact",
                      "code": true
                    },
                    {
                      "text": " 这个 Matcher，它的含义十分明显，一目了然；在后面的测试用例中，我们通过 "
                    },
                    {
                      "text": "todoList.find('li')",
                      "code": true
                    },
                    {
                      "text": " 来获取 "
                    },
                    {
                      "text": "li",
                      "code": true
                    },
                    {
                      "text": " 元素数组，并判断它的长度是否符合要求。"
                    }
                  ]
                },
                {
                  "type": "note",
                  "level": "info",
                  "children": [
                    {
                      "type": "paragraph",
                      "children": [
                        {
                          "text": "你也许发现我们并没有去验证 "
                        },
                        {
                          "text": "TodoList",
                          "code": true
                        },
                        {
                          "text": " 每一项是否符合，这是因为我们用了 Enzyme 的浅层渲染，这意味着所有的 "
                        },
                        {
                          "text": "children",
                          "code": true
                        },
                        {
                          "text": " 都是处于未渲染状态，当然就无法验证内容是否正确了。我们将在下一篇教程中讲解如何去更“深层”地去测试我们的组件。"
                        }
                      ]
                    }
                  ]
                }
              ]
            }
          ]
        },
        {
          "type": "explain",
          "fixed": true,
          "children": [
            {
              "type": "paragraph",
              "children": [
                {
                  "text": "运行 "
                },
                {
                  "text": "npm test",
                  "code": true
                },
                {
                  "text": " ，查看测试结果，全部通过："
                }
              ]
            },
            {
              "type": "code-block",
              "lang": "",
              "children": [
                {
                  "type": "code-line",
                  "children": [
                    {
                      "text": "PASS  app/App.test.js"
                    }
                  ]
                },
                {
                  "type": "code-line",
                  "children": [
                    {
                      "text": "PASS  app/components/ToDoList/ToDoList.test.js"
                    }
                  ]
                },
                {
                  "type": "code-line",
                  "children": [
                    {
                      "text": ""
                    }
                  ]
                },
                {
                  "type": "code-line",
                  "children": [
                    {
                      "text": "Test Suites: 2 passed, 2 total"
                    }
                  ]
                },
                {
                  "type": "code-line",
                  "children": [
                    {
                      "text": "Tests:       4 passed, 4 total"
                    }
                  ]
                },
                {
                  "type": "code-line",
                  "children": [
                    {
                      "text": "Snapshots:   0 total"
                    }
                  ]
                },
                {
                  "type": "code-line",
                  "children": [
                    {
                      "text": "Time:        1.41s"
                    }
                  ]
                },
                {
                  "type": "code-line",
                  "children": [
                    {
                      "text": "Ran all test suites."
                    }
                  ]
                }
              ]
            },
            {
              "type": "heading-three",
              "children": [
                {
                  "text": "小结"
                }
              ],
              "id": "abiioWnke"
            },
            {
              "type": "paragraph",
              "children": [
                {
                  "text": "在过去的两个小节中，我们了解、安装和配置了 Enzyme，并且接触了 "
                },
                {
                  "text": "shallow",
                  "code": true
                },
                {
                  "text": " 浅层渲染这个单元测试利器，并且循序渐进测试了两个 React 组件。但是你应该也注意到了，有些时候浅层渲染并不能完全满足我们的需求，Enzyme 还提供了其他渲染方式以供测试。我们在下篇教程中将讲解新的渲染方式，并介绍快照测试以及 mock 数据，不见不散哦！"
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "commit": "85d5d59ee97d5c24546322d5b40a5577937aa390",
      "id": "4a8beb29",
      "articleId": "387f95a1",
      "type": "step",
      "children": [
        {
          "type": "heading-two",
          "commit": "85d5d59ee97d5c24546322d5b40a5577937aa390",
          "id": "9ace0000",
          "fixed": true,
          "children": [
            {
              "text": "测试组件的 Props"
            }
          ]
        },
        {
          "type": "explain",
          "fixed": true,
          "children": [
            {
              "type": "paragraph",
              "children": [
                {
                  "text": "在前一篇文章中，我们已经测试了传递 Props 给组件的情况。但实际上，我们可以直接测试 Props。让我们回到之前写的 ToDoList 组件，但是这次我们使用一个 Task 组件。"
                }
              ]
            }
          ]
        },
        {
          "file": "src/Task.js",
          "display": true,
          "commit": "85d5d59ee97d5c24546322d5b40a5577937aa390",
          "type": "file",
          "children": [
            {
              "type": "explain",
              "fixed": true,
              "children": [
                {
                  "type": "paragraph",
                  "children": [
                    {
                      "text": "Task 组件的代码如下："
                    }
                  ]
                }
              ]
            },
            {
              "type": "diff-block",
              "file": "src/Task.js",
              "commit": "85d5d59ee97d5c24546322d5b40a5577937aa390",
              "hiddenLines": [],
              "children": [
                {
                  "text": ""
                }
              ]
            },
            {
              "type": "explain",
              "fixed": true,
              "children": [
                {
                  "type": "paragraph",
                  "children": [
                    {
                      "text": ""
                    }
                  ]
                }
              ]
            }
          ]
        },
        {
          "file": "src/TodoList.js",
          "display": true,
          "commit": "85d5d59ee97d5c24546322d5b40a5577937aa390",
          "type": "file",
          "children": [
            {
              "type": "explain",
              "fixed": true,
              "children": [
                {
                  "type": "paragraph",
                  "children": [
                    {
                      "text": "修改后的 TodoList 组件代码如下："
                    }
                  ]
                }
              ]
            },
            {
              "type": "diff-block",
              "file": "src/TodoList.js",
              "commit": "85d5d59ee97d5c24546322d5b40a5577937aa390",
              "hiddenLines": [],
              "children": [
                {
                  "text": ""
                }
              ]
            },
            {
              "type": "explain",
              "fixed": true,
              "children": [
                {
                  "type": "paragraph",
                  "children": [
                    {
                      "text": ""
                    }
                  ]
                }
              ]
            }
          ]
        },
        {
          "file": "src/TodoList.test.js",
          "display": true,
          "commit": "85d5d59ee97d5c24546322d5b40a5577937aa390",
          "type": "file",
          "children": [
            {
              "type": "explain",
              "fixed": true,
              "children": [
                {
                  "type": "paragraph",
                  "children": [
                    {
                      "text": "然后我们来测试 ToDoList 组件是否能够渲染 Task 组件并传递正确的 Props："
                    }
                  ]
                }
              ]
            },
            {
              "type": "diff-block",
              "file": "src/TodoList.test.js",
              "commit": "85d5d59ee97d5c24546322d5b40a5577937aa390",
              "hiddenLines": [
                [
                  0,
                  3
                ],
                [
                  6,
                  16
                ]
              ],
              "children": [
                {
                  "text": ""
                }
              ]
            },
            {
              "type": "explain",
              "fixed": true,
              "children": [
                {
                  "type": "paragraph",
                  "children": [
                    {
                      "text": "通过上面的测试代码，我们可以确定 Task 组件从 ToDoList 收到了正确的 Props。由于 "
                    },
                    {
                      "text": "toDoListInstance",
                      "code": true
                    },
                    {
                      "text": " 和 "
                    },
                    {
                      "text": "taskInstance",
                      "code": true
                    },
                    {
                      "text": " 都是继承自 Enzyme 浅包装器 "
                    },
                    {
                      "text": "ShallowWrapper",
                      "code": true
                    },
                    {
                      "text": "，因此可以调用 "
                    },
                    {
                      "text": "props",
                      "code": true
                    },
                    {
                      "text": " 方法来获取一个组件传入的 Props。不仅如此，我们还可以检查组件状态，甚至更改状态。想要查看可用函数的完整列表，可以浏览 "
                    },
                    {
                      "text": "Enzyme 文档",
                      "link": true,
                      "url": "https://github.com/airbnb/enzyme/blob/master/docs/api/shallow.md"
                    },
                    {
                      "text": "。"
                    }
                  ]
                }
              ]
            }
          ]
        },
        {
          "type": "explain",
          "fixed": true,
          "children": [
            {
              "type": "paragraph",
              "children": [
                {
                  "text": ""
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "commit": "044e603c0157f23e8140ba33ef9671428ff66fdd",
      "id": "904d9880",
      "articleId": "387f95a1",
      "type": "step",
      "children": [
        {
          "type": "heading-two",
          "commit": "044e603c0157f23e8140ba33ef9671428ff66fdd",
          "id": "96957338",
          "fixed": true,
          "children": [
            {
              "text": "通过 mount 进行完全渲染测试"
            }
          ]
        },
        {
          "type": "explain",
          "fixed": true,
          "children": [
            {
              "type": "paragraph",
              "children": [
                {
                  "text": "但是，如果我们想测试 Task 组件中 "
                },
                {
                  "text": "li",
                  "code": true
                },
                {
                  "text": " 标签的实际内容呢？也许我们可以像下面这样写："
                }
              ]
            },
            {
              "type": "code-block",
              "lang": "js",
              "children": [
                {
                  "type": "code-line",
                  "children": [
                    {
                      "text": "toDoListInstance.find('Task').forEach(taskInstance => {"
                    }
                  ]
                },
                {
                  "type": "code-line",
                  "children": [
                    {
                      "text": "  const taskProps = taskInstance.props();"
                    }
                  ]
                },
                {
                  "type": "code-line",
                  "children": [
                    {
                      "text": "  const matchingTask = tasks.find(task => task.id === taskProps.id);"
                    }
                  ]
                },
                {
                  "type": "code-line",
                  "children": [
                    {
                      "text": "  const listItem = taskInstance.first('li');"
                    }
                  ]
                },
                {
                  "type": "code-line",
                  "children": [
                    {
                      "text": "  expect(listItem.text()).toBe(matchingTask.name);"
                    }
                  ]
                },
                {
                  "type": "code-line",
                  "children": [
                    {
                      "text": "}"
                    }
                  ]
                }
              ]
            },
            {
              "type": "paragraph",
              "children": [
                {
                  "text": "如果运行测试，我们会遇到一个错误:"
                }
              ]
            },
            {
              "type": "code-block",
              "lang": "",
              "children": [
                {
                  "type": "code-line",
                  "children": [
                    {
                      "text": "FAIL app/components/ToDoList/ToDoList.test.js"
                    }
                  ]
                },
                {
                  "type": "code-line",
                  "children": [
                    {
                      "text": ""
                    }
                  ]
                },
                {
                  "type": "code-line",
                  "children": [
                    {
                      "text": " ● ToDoList component › when provided with array of tasks › passes them to the Task components"
                    }
                  ]
                },
                {
                  "type": "code-line",
                  "children": [
                    {
                      "text": ""
                    }
                  ]
                },
                {
                  "type": "code-line",
                  "children": [
                    {
                      "text": "  expect(received).toBe(expected) // Object.is equality"
                    }
                  ]
                },
                {
                  "type": "code-line",
                  "children": [
                    {
                      "text": ""
                    }
                  ]
                },
                {
                  "type": "code-line",
                  "children": [
                    {
                      "text": "  Expected: \"Wash the dishes\""
                    }
                  ]
                },
                {
                  "type": "code-line",
                  "children": [
                    {
                      "text": "  Received: \"<Task />\""
                    }
                  ]
                },
                {
                  "type": "code-line",
                  "children": [
                    {
                      "text": ""
                    }
                  ]
                },
                {
                  "type": "code-line",
                  "children": [
                    {
                      "text": "   23 |     const matchingTask = tasks.find(task => task.id === taskProps.id);"
                    }
                  ]
                },
                {
                  "type": "code-line",
                  "children": [
                    {
                      "text": "   24 |     const listItem = taskInstance.first('li');"
                    }
                  ]
                },
                {
                  "type": "code-line",
                  "children": [
                    {
                      "text": "  \\> 25 |     expect(listItem.text()).toBe(matchingTask.name);"
                    }
                  ]
                },
                {
                  "type": "code-line",
                  "children": [
                    {
                      "text": "​     |                 ^"
                    }
                  ]
                },
                {
                  "type": "code-line",
                  "children": [
                    {
                      "text": "   26 |    })"
                    }
                  ]
                },
                {
                  "type": "code-line",
                  "children": [
                    {
                      "text": "   27 |   })"
                    }
                  ]
                },
                {
                  "type": "code-line",
                  "children": [
                    {
                      "text": "   28 |  });"
                    }
                  ]
                }
              ]
            },
            {
              "type": "paragraph",
              "children": [
                {
                  "text": "这里之所以失败，是因为浅层渲染 shallow 的局限性：子组件 Task 将根本不会渲染，因此就无法判断是否渲染出正确的内容。"
                }
              ]
            }
          ]
        },
        {
          "file": "src/TodoList.test.js",
          "display": true,
          "commit": "044e603c0157f23e8140ba33ef9671428ff66fdd",
          "type": "file",
          "children": [
            {
              "type": "explain",
              "fixed": true,
              "children": [
                {
                  "type": "paragraph",
                  "children": [
                    {
                      "text": "针对浅层渲染的局限性，Enzyme 提供了完全渲染函数 "
                    },
                    {
                      "text": "mount",
                      "code": true
                    },
                    {
                      "text": "。修改 TodoList 测试文件，代码如下："
                    }
                  ]
                }
              ]
            },
            {
              "type": "diff-block",
              "file": "src/TodoList.test.js",
              "commit": "044e603c0157f23e8140ba33ef9671428ff66fdd",
              "hiddenLines": [
                [
                  7,
                  39
                ]
              ],
              "children": [
                {
                  "text": ""
                }
              ]
            },
            {
              "type": "explain",
              "fixed": true,
              "children": [
                {
                  "type": "paragraph",
                  "children": [
                    {
                      "text": "上面的代码会将完整的 ToDoList 和它所有子组件一起渲染。因此，之前失败的测试现在就会通过。"
                    }
                  ]
                }
              ]
            }
          ]
        },
        {
          "type": "explain",
          "fixed": true,
          "children": [
            {
              "type": "paragraph",
              "children": [
                {
                  "text": "由于 "
                },
                {
                  "text": "mount",
                  "code": true
                },
                {
                  "text": " 函数会模拟实际的 DOM，渲染成本更高，因此运行测试会花费更多的时间。通常我们会在集成测试中使用 "
                },
                {
                  "text": "mount",
                  "code": true
                },
                {
                  "text": " 函数，测试组件之间如何协同工作，而不仅仅是作为独立的单元。"
                }
              ]
            },
            {
              "type": "block-quote",
              "children": [
                {
                  "type": "paragraph",
                  "children": [
                    {
                      "text": "如果你不了解单元测试和集成测试这两个术语，可以看下本系列第一篇教程。"
                    }
                  ]
                }
              ]
            },
            {
              "type": "paragraph",
              "children": [
                {
                  "text": "在测试与 DOM 的交互或者在处理高阶组件时，mount 函数也可以派上用场。"
                },
                {
                  "text": "Mount 使用 DOM 实现的模拟，Jest 默认使用的是 jsdom。我们可以通过调整 ",
                  "italic": true
                },
                {
                  "text": "testEnvironment",
                  "italic": true,
                  "code": true
                },
                {
                  "text": " "
                },
                {
                  "text": "属性更改。",
                  "italic": true
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "commit": "90f50e4bc85425dda71fc90e0b8ee856f84e6012",
      "id": "c8064f9d",
      "articleId": "387f95a1",
      "type": "step",
      "children": [
        {
          "type": "heading-two",
          "commit": "90f50e4bc85425dda71fc90e0b8ee856f84e6012",
          "id": "53f5641a",
          "fixed": true,
          "children": [
            {
              "text": "尝鲜 Jest Snapshot 测试"
            }
          ]
        },
        {
          "type": "explain",
          "fixed": true,
          "children": [
            {
              "type": "paragraph",
              "children": [
                {
                  "text": "快照测试是 Jest 的一大招牌功能。所谓快照，可以简单地理解成是我们应用的一个"
                },
                {
                  "text": "“代码截图”",
                  "bold": true
                },
                {
                  "text": "。当我们运行快照测试时，Jest 将会渲染组件并创建其快照文件。这个快照文件包含渲染后组件的整个结构，并且应该与测试文件本身一起提交到代码库。当我们再次运行快照测试时，Jest 会将新的快照与旧的快照进行比较，如果两者不一致，测试就会失败，从而帮助我们确保用户界面不会发生意外改变。"
                }
              ]
            }
          ]
        },
        {
          "file": "src/TodoList.test.js",
          "display": true,
          "commit": "90f50e4bc85425dda71fc90e0b8ee856f84e6012",
          "type": "file",
          "children": [
            {
              "type": "explain",
              "fixed": true,
              "children": [
                {
                  "type": "paragraph",
                  "children": [
                    {
                      "text": "在 TodoList 的测试代码中添加快照测试："
                    }
                  ]
                }
              ]
            },
            {
              "type": "diff-block",
              "file": "src/TodoList.test.js",
              "commit": "90f50e4bc85425dda71fc90e0b8ee856f84e6012",
              "hiddenLines": [
                [
                  0,
                  3
                ],
                [
                  6,
                  16
                ],
                [
                  19,
                  49
                ]
              ],
              "children": [
                {
                  "text": ""
                }
              ]
            },
            {
              "type": "explain",
              "fixed": true,
              "children": [
                {
                  "type": "paragraph",
                  "children": [
                    {
                      "text": ""
                    }
                  ]
                }
              ]
            }
          ]
        },
        {
          "file": "src/__snapshots__/TodoList.test.js.snap",
          "display": true,
          "commit": "90f50e4bc85425dda71fc90e0b8ee856f84e6012",
          "type": "file",
          "children": [
            {
              "type": "explain",
              "fixed": true,
              "children": [
                {
                  "type": "paragraph",
                  "children": [
                    {
                      "text": "运行上面的代码后，就会产生 ToDoList.test.js.snap 文件，它的内容如下："
                    }
                  ]
                }
              ]
            },
            {
              "type": "diff-block",
              "file": "src/__snapshots__/TodoList.test.js.snap",
              "commit": "90f50e4bc85425dda71fc90e0b8ee856f84e6012",
              "hiddenLines": [],
              "children": [
                {
                  "text": ""
                }
              ]
            },
            {
              "type": "explain",
              "fixed": true,
              "children": [
                {
                  "type": "paragraph",
                  "children": [
                    {
                      "text": ""
                    }
                  ]
                }
              ]
            }
          ]
        },
        {
          "type": "explain",
          "fixed": true,
          "children": [
            {
              "type": "paragraph",
              "children": [
                {
                  "text": "如果我们要对 ToDoList 组件进行任何更改，快照测试就会失败，并且显示当前渲染结果与快照之间的精确差异。如果我们要更新所有失败的快照，可以使用 "
                },
                {
                  "text": "-u",
                  "code": true
                },
                {
                  "text": " 标志(别名为 "
                },
                {
                  "text": "--updateSnapshot",
                  "code": true
                },
                {
                  "text": ") 来运行 Jest。输入以下命令，一键更新所有快照： "
                }
              ]
            },
            {
              "type": "code-block",
              "children": [
                {
                  "type": "code-line",
                  "children": [
                    {
                      "text": "npm test -- -u"
                    }
                  ]
                }
              ]
            },
            {
              "type": "paragraph",
              "children": [
                {
                  "text": "实际上，目前 CRA 默认会在监听模式下运行 Jest，我们可以一个个更新冲突的快照。首先运行 "
                },
                {
                  "text": "npm test",
                  "code": true
                },
                {
                  "text": " ，然后输入 "
                },
                {
                  "text": "i",
                  "code": true
                },
                {
                  "text": " 以交互方式更新失败的快照。官方的 Jest 文档提供了一个动画来展示这个过程："
                }
              ]
            },
            {
              "type": "image",
              "url": "https://static.tuture.co/c/f40c6ff/interactiveSnapshotUpdate.gif",
              "children": [
                {
                  "text": ""
                }
              ]
            },
            {
              "type": "note",
              "level": "info",
              "children": [
                {
                  "type": "paragraph",
                  "children": [
                    {
                      "text": "如果你的 CRA 版本比较老，可以通过 "
                    },
                    {
                      "text": "npm test -- --watchAll",
                      "code": true
                    },
                    {
                      "text": " 来进入 Jest 监听模式。"
                    }
                  ]
                }
              ]
            },
            {
              "type": "heading-two",
              "children": [
                {
                  "text": "小结"
                }
              ],
              "id": "LIBTDeSLe"
            },
            {
              "type": "paragraph",
              "children": [
                {
                  "text": "在本文中，我们介绍了如何直接去测试组件的 Props，并学习了 mount 函数和浅层渲染之间的区别。除此之外，我们还介绍了 Jest 快照测试，这是一个非常强大的工具，可以追踪组件渲染方式的变化。在接下来的文章中，我们还将介绍测试中常见的 Mock 技巧——与组件的模拟交互，不见不散！"
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "commit": "8e302e8b465eceffa937897caf6b21cdafc3f2d4",
      "id": "fdec7cc8",
      "articleId": "34217fa9",
      "type": "step",
      "children": [
        {
          "type": "heading-two",
          "commit": "8e302e8b465eceffa937897caf6b21cdafc3f2d4",
          "id": "94a2160f",
          "fixed": true,
          "children": [
            {
              "text": "初次尝试 Jest Mock"
            }
          ]
        },
        {
          "type": "explain",
          "fixed": true,
          "children": [
            {
              "type": "paragraph",
              "children": [
                {
                  "text": "我们的应用程序通常需要从外部的 API 获取数据。在编写测试时，外部 API 可能由于各种原因而失败。我们希望我们的测试是可靠和独立的，而最常见的解决方案就是 Mock。"
                }
              ]
            },
            {
              "type": "heading-three",
              "children": [
                {
                  "text": "改写 TodoList 组件"
                }
              ],
              "id": "nrgIPel1d"
            },
            {
              "type": "paragraph",
              "children": [
                {
                  "text": "首先让我们改造组件，使其能够通过 API 获取数据。安装 axios："
                }
              ]
            },
            {
              "type": "code-block",
              "lang": "bash",
              "children": [
                {
                  "type": "code-line",
                  "children": [
                    {
                      "text": "npm install axios"
                    }
                  ]
                }
              ]
            }
          ]
        },
        {
          "type": "file",
          "file": "package-lock.json",
          "display": false,
          "children": [
            {
              "type": "explain",
              "fixed": true,
              "children": [
                {
                  "type": "paragraph",
                  "children": [
                    {
                      "text": ""
                    }
                  ]
                }
              ]
            },
            {
              "type": "diff-block",
              "file": "package-lock.json",
              "commit": "8e302e8b465eceffa937897caf6b21cdafc3f2d4",
              "hiddenLines": [
                [
                  0,
                  2512
                ]
              ],
              "children": [
                {
                  "text": ""
                }
              ]
            },
            {
              "type": "explain",
              "fixed": true,
              "children": [
                {
                  "type": "paragraph",
                  "children": [
                    {
                      "text": ""
                    }
                  ]
                }
              ]
            }
          ]
        },
        {
          "file": "package.json",
          "display": false,
          "commit": "8e302e8b465eceffa937897caf6b21cdafc3f2d4",
          "type": "file",
          "children": [
            {
              "type": "explain",
              "fixed": true,
              "children": [
                {
                  "type": "paragraph",
                  "children": [
                    {
                      "text": ""
                    }
                  ]
                }
              ]
            },
            {
              "type": "diff-block",
              "file": "package.json",
              "commit": "8e302e8b465eceffa937897caf6b21cdafc3f2d4",
              "hiddenLines": [
                [
                  0,
                  4
                ]
              ],
              "children": [
                {
                  "text": ""
                }
              ]
            },
            {
              "type": "explain",
              "fixed": true,
              "children": [
                {
                  "type": "paragraph",
                  "children": [
                    {
                      "text": ""
                    }
                  ]
                }
              ]
            }
          ]
        },
        {
          "file": "src/TodoList.js",
          "display": true,
          "commit": "8e302e8b465eceffa937897caf6b21cdafc3f2d4",
          "type": "file",
          "children": [
            {
              "type": "explain",
              "fixed": true,
              "children": [
                {
                  "type": "paragraph",
                  "children": [
                    {
                      "text": "然后改写 "
                    },
                    {
                      "text": "TodoList",
                      "code": true
                    },
                    {
                      "text": " 组件如下："
                    }
                  ]
                }
              ]
            },
            {
              "type": "diff-block",
              "file": "src/TodoList.js",
              "commit": "8e302e8b465eceffa937897caf6b21cdafc3f2d4",
              "hiddenLines": [],
              "children": [
                {
                  "text": ""
                }
              ]
            },
            {
              "type": "explain",
              "fixed": true,
              "children": [
                {
                  "type": "paragraph",
                  "children": [
                    {
                      "text": "TodoList",
                      "code": true
                    },
                    {
                      "text": " 被改造成了一个“聪明组件”，在 "
                    },
                    {
                      "text": "componentDidMount",
                      "code": true
                    },
                    {
                      "text": " 生命周期函数中通过 "
                    },
                    {
                      "text": "axios",
                      "code": true
                    },
                    {
                      "text": " 模块异步获取数据。"
                    }
                  ]
                }
              ]
            }
          ]
        },
        {
          "file": "src/__mocks__/axios.js",
          "display": true,
          "commit": "8e302e8b465eceffa937897caf6b21cdafc3f2d4",
          "type": "file",
          "children": [
            {
              "type": "explain",
              "fixed": true,
              "children": [
                {
                  "type": "heading-three",
                  "children": [
                    {
                      "text": "编写 axios 模块的 mock 文件"
                    }
                  ],
                  "id": "liHOzzkHf"
                },
                {
                  "type": "paragraph",
                  "children": [
                    {
                      "text": "Jest 支持对整个模块进行 Mock，使得组件不会调用原始的模块，而是调用我们预设的 Mock 模块。按照官方推荐，我们创建 "
                    },
                    {
                      "bold": true,
                      "text": "mocks"
                    },
                    {
                      "text": " 目录并把 mock 文件放到其中。创建 axios 的 Mock 文件 axios.js，代码如下："
                    }
                  ]
                }
              ]
            },
            {
              "type": "diff-block",
              "file": "src/__mocks__/axios.js",
              "commit": "8e302e8b465eceffa937897caf6b21cdafc3f2d4",
              "hiddenLines": [],
              "children": [
                {
                  "text": ""
                }
              ]
            },
            {
              "type": "explain",
              "fixed": true,
              "children": [
                {
                  "type": "paragraph",
                  "children": [
                    {
                      "text": "这里的 axios 模块提供了一个 "
                    },
                    {
                      "text": "get",
                      "code": true
                    },
                    {
                      "text": " 函数，并且会返回一个 Promise，包含预先设定的假数据。"
                    }
                  ]
                }
              ]
            }
          ]
        },
        {
          "file": "src/TodoList.test.js",
          "display": true,
          "commit": "8e302e8b465eceffa937897caf6b21cdafc3f2d4",
          "type": "file",
          "children": [
            {
              "type": "explain",
              "fixed": true,
              "children": [
                {
                  "type": "heading-three",
                  "children": [
                    {
                      "text": "通过 spyOn 函数检查 Mock 模块调用情况"
                    }
                  ],
                  "id": "bL2J0ym9M"
                },
                {
                  "type": "paragraph",
                  "children": [
                    {
                      "text": "让我们开始 Mock 起来！打开 TodoList 的测试文件，首先在最前面通过 "
                    },
                    {
                      "text": "jest.mock",
                      "code": true
                    },
                    {
                      "text": " 配置 axios 模块的 Mock（确保要在 "
                    },
                    {
                      "text": "import TodoList",
                      "code": true
                    },
                    {
                      "text": " 之前），在 Mock 之后，无论在测试还是组件中使用的都将是 Mock 版本的 axios。然后创建一个测试用例，检查 Mock 模块是否被正确调用。代码如下："
                    }
                  ]
                }
              ]
            },
            {
              "type": "diff-block",
              "file": "src/TodoList.test.js",
              "commit": "8e302e8b465eceffa937897caf6b21cdafc3f2d4",
              "hiddenLines": [
                [
                  9,
                  58
                ]
              ],
              "children": [
                {
                  "text": ""
                }
              ]
            },
            {
              "type": "explain",
              "fixed": true,
              "children": [
                {
                  "type": "paragraph",
                  "children": [
                    {
                      "text": "测试模块中一个函数是否被调用实际上是比较困难的，但是所幸 Jest 为我们提供了完整的支持。首先通过 "
                    },
                    {
                      "text": "jest.spyOn",
                      "code": true
                    },
                    {
                      "text": "，我们便可以监听一个函数的使用情况，然后使用配套的 "
                    },
                    {
                      "text": "toBeCalled",
                      "code": true
                    },
                    {
                      "text": " Matcher 来判断该函数是否被调用。整体代码十分简洁，同时也保持了很好的可读性。"
                    }
                  ]
                }
              ]
            }
          ]
        },
        {
          "file": "src/__snapshots__/TodoList.test.js.snap",
          "display": false,
          "commit": "8e302e8b465eceffa937897caf6b21cdafc3f2d4",
          "type": "file",
          "children": [
            {
              "type": "explain",
              "fixed": true,
              "children": [
                {
                  "type": "paragraph",
                  "children": [
                    {
                      "text": ""
                    }
                  ]
                }
              ]
            },
            {
              "type": "diff-block",
              "file": "src/__snapshots__/TodoList.test.js.snap",
              "commit": "8e302e8b465eceffa937897caf6b21cdafc3f2d4",
              "hiddenLines": [],
              "children": [
                {
                  "text": ""
                }
              ]
            },
            {
              "type": "explain",
              "fixed": true,
              "children": [
                {
                  "type": "paragraph",
                  "children": [
                    {
                      "text": ""
                    }
                  ]
                }
              ]
            }
          ]
        },
        {
          "type": "explain",
          "fixed": true,
          "children": [
            {
              "type": "block-quote",
              "children": [
                {
                  "type": "paragraph",
                  "children": [
                    {
                      "text": "如果你忘记了 Jest Matcher 的含义，推荐阅读本系列的第一篇教程。"
                    }
                  ]
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "commit": "94383096931adfda215c8d386a833993e8932105",
      "id": "1fd5caed",
      "articleId": "34217fa9",
      "type": "step",
      "children": [
        {
          "type": "heading-two",
          "commit": "94383096931adfda215c8d386a833993e8932105",
          "id": "365eaf7a",
          "fixed": true,
          "children": [
            {
              "text": "迭代 TodoList 组件"
            }
          ]
        },
        {
          "type": "explain",
          "fixed": true,
          "children": [
            {
              "type": "paragraph",
              "children": [
                {
                  "text": ""
                }
              ]
            }
          ]
        },
        {
          "type": "file",
          "file": ".gitignore",
          "display": false,
          "children": [
            {
              "type": "explain",
              "fixed": true,
              "children": [
                {
                  "type": "paragraph",
                  "children": [
                    {
                      "text": ""
                    }
                  ]
                }
              ]
            },
            {
              "type": "diff-block",
              "file": ".gitignore",
              "commit": "94383096931adfda215c8d386a833993e8932105",
              "hiddenLines": [
                [
                  0,
                  19
                ]
              ],
              "children": [
                {
                  "text": ""
                }
              ]
            },
            {
              "type": "explain",
              "fixed": true,
              "children": [
                {
                  "type": "paragraph",
                  "children": [
                    {
                      "text": ""
                    }
                  ]
                }
              ]
            }
          ]
        },
        {
          "type": "file",
          "file": ".tutureignore",
          "display": false,
          "children": [
            {
              "type": "explain",
              "fixed": true,
              "children": [
                {
                  "type": "paragraph",
                  "children": [
                    {
                      "text": ""
                    }
                  ]
                }
              ]
            },
            {
              "type": "diff-block",
              "file": ".tutureignore",
              "commit": "94383096931adfda215c8d386a833993e8932105",
              "hiddenLines": [],
              "children": [
                {
                  "text": ""
                }
              ]
            },
            {
              "type": "explain",
              "fixed": true,
              "children": [
                {
                  "type": "paragraph",
                  "children": [
                    {
                      "text": ""
                    }
                  ]
                }
              ]
            }
          ]
        },
        {
          "file": "src/TodoList.js",
          "display": true,
          "commit": "94383096931adfda215c8d386a833993e8932105",
          "type": "file",
          "children": [
            {
              "type": "explain",
              "fixed": true,
              "children": [
                {
                  "type": "paragraph",
                  "children": [
                    {
                      "text": "一个实际的项目总会不断迭代，当然也包括我们的 TodoList 组件。对于一个待办事项应用来说，最重要的当然便是添加新的待办事项。"
                    }
                  ]
                },
                {
                  "type": "paragraph",
                  "children": [
                    {
                      "text": "修改 TodoList 组件，代码如下："
                    }
                  ]
                }
              ]
            },
            {
              "type": "diff-block",
              "file": "src/TodoList.js",
              "commit": "94383096931adfda215c8d386a833993e8932105",
              "hiddenLines": [
                [
                  0,
                  6
                ],
                [
                  14,
                  18
                ]
              ],
              "children": [
                {
                  "text": ""
                }
              ]
            },
            {
              "type": "explain",
              "fixed": true,
              "children": [
                {
                  "type": "paragraph",
                  "children": [
                    {
                      "text": "由于我们大幅改动了 TodoList 组件，我们需要更新快照："
                    }
                  ]
                },
                {
                  "type": "code-block",
                  "lang": "shell",
                  "children": [
                    {
                      "type": "code-line",
                      "children": [
                        {
                          "text": "npm test -- -u"
                        }
                      ]
                    }
                  ]
                }
              ]
            }
          ]
        },
        {
          "file": "src/__snapshots__/TodoList.test.js.snap",
          "display": true,
          "commit": "94383096931adfda215c8d386a833993e8932105",
          "type": "file",
          "children": [
            {
              "type": "explain",
              "fixed": true,
              "children": [
                {
                  "type": "block-quote",
                  "children": [
                    {
                      "type": "paragraph",
                      "children": [
                        {
                          "text": "如果你不熟悉 Jest 快照测试，请回看本系列第二篇教程。"
                        }
                      ]
                    }
                  ]
                },
                {
                  "type": "paragraph",
                  "children": [
                    {
                      "text": "更新后的快照文件反映了我们刚刚做的变化："
                    }
                  ]
                }
              ]
            },
            {
              "type": "diff-block",
              "file": "src/__snapshots__/TodoList.test.js.snap",
              "commit": "94383096931adfda215c8d386a833993e8932105",
              "hiddenLines": [],
              "children": [
                {
                  "text": ""
                }
              ]
            },
            {
              "type": "explain",
              "fixed": true,
              "children": [
                {
                  "type": "paragraph",
                  "children": [
                    {
                      "text": ""
                    }
                  ]
                }
              ]
            }
          ]
        },
        {
          "type": "explain",
          "fixed": true,
          "children": [
            {
              "type": "paragraph",
              "children": [
                {
                  "text": ""
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "commit": "89cbd5ac9c568340204048528b626184d50a6307",
      "id": "decb91ee",
      "articleId": "34217fa9",
      "type": "step",
      "children": [
        {
          "type": "heading-two",
          "commit": "89cbd5ac9c568340204048528b626184d50a6307",
          "id": "f092d430",
          "fixed": true,
          "children": [
            {
              "text": "在测试中模拟 React 组件的交互"
            }
          ]
        },
        {
          "type": "explain",
          "fixed": true,
          "children": [
            {
              "type": "paragraph",
              "children": [
                {
                  "text": "在上面迭代的 TodoList 中，我们使用了 axios.post。 这意味着我们需要扩展 axios 的 mock 文件："
                }
              ]
            }
          ]
        },
        {
          "file": "src/__mocks__/axios.js",
          "display": true,
          "commit": "89cbd5ac9c568340204048528b626184d50a6307",
          "type": "file",
          "children": [
            {
              "type": "explain",
              "fixed": true,
              "children": [
                {
                  "type": "paragraph",
                  "children": [
                    {
                      "text": ""
                    }
                  ]
                }
              ]
            },
            {
              "type": "diff-block",
              "file": "src/__mocks__/axios.js",
              "commit": "89cbd5ac9c568340204048528b626184d50a6307",
              "hiddenLines": [
                [
                  7,
                  15
                ]
              ],
              "children": [
                {
                  "text": ""
                }
              ]
            },
            {
              "type": "explain",
              "fixed": true,
              "children": [
                {
                  "type": "block-quote",
                  "children": [
                    {
                      "type": "paragraph",
                      "children": [
                        {
                          "text": "可以看到上面，我们添加了一个 "
                        },
                        {
                          "text": "currentId",
                          "code": true
                        },
                        {
                          "text": " 变量，因为我们需要保持每个 task 的唯一性。"
                        }
                      ]
                    }
                  ]
                },
                {
                  "type": "paragraph",
                  "children": [
                    {
                      "text": "让我们开始测试吧！我们测试的第一件事是检查修改输入值是否更改了我们的状态："
                    }
                  ]
                },
                {
                  "type": "paragraph",
                  "children": [
                    {
                      "text": "我们修改 "
                    },
                    {
                      "text": "app/components/TodoList.test.js",
                      "code": true
                    },
                    {
                      "text": " 如下："
                    }
                  ]
                },
                {
                  "type": "code-block",
                  "lang": "js",
                  "children": [
                    {
                      "type": "code-line",
                      "children": [
                        {
                          "text": "import React from 'react';"
                        }
                      ]
                    },
                    {
                      "type": "code-line",
                      "children": [
                        {
                          "text": "import { shallow } from 'enzyme';"
                        }
                      ]
                    },
                    {
                      "type": "code-line",
                      "children": [
                        {
                          "text": "import ToDoList from './ToDoList';"
                        }
                      ]
                    },
                    {
                      "type": "code-line",
                      "children": [
                        {
                          "text": ""
                        }
                      ]
                    },
                    {
                      "type": "code-line",
                      "children": [
                        {
                          "text": ""
                        }
                      ]
                    },
                    {
                      "type": "code-line",
                      "children": [
                        {
                          "text": "describe('ToDoList component', () => {"
                        }
                      ]
                    },
                    {
                      "type": "code-line",
                      "children": [
                        {
                          "text": "  describe('when the value of its input is changed', () => {"
                        }
                      ]
                    },
                    {
                      "type": "code-line",
                      "children": [
                        {
                          "text": "    it('its state should be changed', () => {"
                        }
                      ]
                    },
                    {
                      "type": "code-line",
                      "children": [
                        {
                          "text": "      const toDoListInstance = shallow("
                        }
                      ]
                    },
                    {
                      "type": "code-line",
                      "children": [
                        {
                          "text": "        <ToDoList/>"
                        }
                      ]
                    },
                    {
                      "type": "code-line",
                      "children": [
                        {
                          "text": "      );"
                        }
                      ]
                    },
                    {
                      "type": "code-line",
                      "children": [
                        {
                          "text": ""
                        }
                      ]
                    },
                    {
                      "type": "code-line",
                      "children": [
                        {
                          "text": ""
                        }
                      ]
                    },
                    {
                      "type": "code-line",
                      "children": [
                        {
                          "text": "      const newTask = 'new task name';"
                        }
                      ]
                    },
                    {
                      "type": "code-line",
                      "children": [
                        {
                          "text": "      const taskInput = toDoListInstance.find('input');"
                        }
                      ]
                    },
                    {
                      "type": "code-line",
                      "children": [
                        {
                          "text": "      taskInput.simulate('change', { target: { value: newTask }});"
                        }
                      ]
                    },
                    {
                      "type": "code-line",
                      "children": [
                        {
                          "text": ""
                        }
                      ]
                    },
                    {
                      "type": "code-line",
                      "children": [
                        {
                          "text": "      expect(toDoListInstance.state().newTask).toEqual(newTask);"
                        }
                      ]
                    },
                    {
                      "type": "code-line",
                      "children": [
                        {
                          "text": "    });"
                        }
                      ]
                    },
                    {
                      "type": "code-line",
                      "children": [
                        {
                          "text": "  });"
                        }
                      ]
                    },
                    {
                      "type": "code-line",
                      "children": [
                        {
                          "text": "});"
                        }
                      ]
                    }
                  ]
                },
                {
                  "type": "paragraph",
                  "children": [
                    {
                      "text": "这里要重点指出的就是 "
                    },
                    {
                      "text": "simulate",
                      "link": true,
                      "url": "https://enzymejs.github.io/enzyme/docs/api/ShallowWrapper/simulate.html"
                    },
                    {
                      "text": " 函数的调用。 这是我们几次提到的ShallowWrapper的功能。 我们用它来模拟事件。它第一个参数是事件的类型（由于我们在输入中使用onChange，因此我们应该在此处使用change），第二个参数是模拟事件对象（event）。"
                    }
                  ]
                },
                {
                  "type": "paragraph",
                  "children": [
                    {
                      "text": "为了进一步说明问题，让我们测试一下用户单击按钮后是否从我们的组件发送了实际的 post 请求。我们修改测试代码如下："
                    }
                  ]
                },
                {
                  "type": "code-block",
                  "lang": "js",
                  "children": [
                    {
                      "type": "code-line",
                      "children": [
                        {
                          "text": "import React from 'react';"
                        }
                      ]
                    },
                    {
                      "type": "code-line",
                      "children": [
                        {
                          "text": "import { shallow } from 'enzyme';"
                        }
                      ]
                    },
                    {
                      "type": "code-line",
                      "children": [
                        {
                          "text": "import ToDoList from './ToDoList';"
                        }
                      ]
                    },
                    {
                      "type": "code-line",
                      "children": [
                        {
                          "text": "import axios from 'axios';"
                        }
                      ]
                    },
                    {
                      "type": "code-line",
                      "children": [
                        {
                          "text": ""
                        }
                      ]
                    },
                    {
                      "type": "code-line",
                      "children": [
                        {
                          "text": "jest.mock('axios');"
                        }
                      ]
                    },
                    {
                      "type": "code-line",
                      "children": [
                        {
                          "text": ""
                        }
                      ]
                    },
                    {
                      "type": "code-line",
                      "children": [
                        {
                          "text": "describe('ToDoList component', () => {"
                        }
                      ]
                    },
                    {
                      "type": "code-line",
                      "children": [
                        {
                          "text": "  describe('when the button is clicked with the input filled out', () => {"
                        }
                      ]
                    },
                    {
                      "type": "code-line",
                      "children": [
                        {
                          "text": "    it('a post request should be made', () => {"
                        }
                      ]
                    },
                    {
                      "type": "code-line",
                      "children": [
                        {
                          "text": "      const toDoListInstance = shallow("
                        }
                      ]
                    },
                    {
                      "type": "code-line",
                      "children": [
                        {
                          "text": "        <ToDoList/>"
                        }
                      ]
                    },
                    {
                      "type": "code-line",
                      "children": [
                        {
                          "text": "      );"
                        }
                      ]
                    },
                    {
                      "type": "code-line",
                      "children": [
                        {
                          "text": "      const postSpy = jest.spyOn(axios, 'post');"
                        }
                      ]
                    },
                    {
                      "type": "code-line",
                      "children": [
                        {
                          "text": ""
                        }
                      ]
                    },
                    {
                      "type": "code-line",
                      "children": [
                        {
                          "text": ""
                        }
                      ]
                    },
                    {
                      "type": "code-line",
                      "children": [
                        {
                          "text": "      const newTask = 'new task name';"
                        }
                      ]
                    },
                    {
                      "type": "code-line",
                      "children": [
                        {
                          "text": "      const taskInput = toDoListInstance.find('input');"
                        }
                      ]
                    },
                    {
                      "type": "code-line",
                      "children": [
                        {
                          "text": "      taskInput.simulate('change', { target: { value: newTask }});"
                        }
                      ]
                    },
                    {
                      "type": "code-line",
                      "children": [
                        {
                          "text": ""
                        }
                      ]
                    },
                    {
                      "type": "code-line",
                      "children": [
                        {
                          "text": ""
                        }
                      ]
                    },
                    {
                      "type": "code-line",
                      "children": [
                        {
                          "text": "      const button = toDoListInstance.find('button');"
                        }
                      ]
                    },
                    {
                      "type": "code-line",
                      "children": [
                        {
                          "text": "      button.simulate('click');"
                        }
                      ]
                    },
                    {
                      "type": "code-line",
                      "children": [
                        {
                          "text": ""
                        }
                      ]
                    },
                    {
                      "type": "code-line",
                      "children": [
                        {
                          "text": ""
                        }
                      ]
                    },
                    {
                      "type": "code-line",
                      "children": [
                        {
                          "text": "      expect(postSpy).toBeCalled();"
                        }
                      ]
                    },
                    {
                      "type": "code-line",
                      "children": [
                        {
                          "text": "    });"
                        }
                      ]
                    },
                    {
                      "type": "code-line",
                      "children": [
                        {
                          "text": "  });"
                        }
                      ]
                    },
                    {
                      "type": "code-line",
                      "children": [
                        {
                          "text": "});"
                        }
                      ]
                    }
                  ]
                }
              ]
            }
          ]
        },
        {
          "file": "src/TodoList.test.js",
          "display": false,
          "commit": "89cbd5ac9c568340204048528b626184d50a6307",
          "type": "file",
          "children": [
            {
              "type": "explain",
              "fixed": true,
              "children": [
                {
                  "type": "paragraph",
                  "children": [
                    {
                      "text": ""
                    }
                  ]
                }
              ]
            },
            {
              "type": "diff-block",
              "file": "src/TodoList.test.js",
              "commit": "89cbd5ac9c568340204048528b626184d50a6307",
              "hiddenLines": [
                [
                  0,
                  63
                ]
              ],
              "children": [
                {
                  "text": ""
                }
              ]
            },
            {
              "type": "explain",
              "fixed": true,
              "children": [
                {
                  "type": "paragraph",
                  "children": [
                    {
                      "text": ""
                    }
                  ]
                }
              ]
            }
          ]
        },
        {
          "type": "explain",
          "fixed": true,
          "children": [
            {
              "type": "paragraph",
              "children": [
                {
                  "text": "感谢我们的 mock 和 simulate 事件，测试通过了！\n现在事情会变得有些棘手。 我们将测试状态是否随着我们的新任务而更新，其中比较有趣的是请求是异步的，我们继续修改代码如下："
                }
              ]
            },
            {
              "type": "code-block",
              "lang": "js",
              "children": [
                {
                  "type": "code-line",
                  "children": [
                    {
                      "text": "import React from 'react';"
                    }
                  ]
                },
                {
                  "type": "code-line",
                  "children": [
                    {
                      "text": "import { shallow } from 'enzyme';"
                    }
                  ]
                },
                {
                  "type": "code-line",
                  "children": [
                    {
                      "text": "import ToDoList from './ToDoList';"
                    }
                  ]
                },
                {
                  "type": "code-line",
                  "children": [
                    {
                      "text": "import axios from 'axios';"
                    }
                  ]
                },
                {
                  "type": "code-line",
                  "children": [
                    {
                      "text": ""
                    }
                  ]
                },
                {
                  "type": "code-line",
                  "children": [
                    {
                      "text": ""
                    }
                  ]
                },
                {
                  "type": "code-line",
                  "children": [
                    {
                      "text": "jest.mock('axios');"
                    }
                  ]
                },
                {
                  "type": "code-line",
                  "children": [
                    {
                      "text": ""
                    }
                  ]
                },
                {
                  "type": "code-line",
                  "children": [
                    {
                      "text": ""
                    }
                  ]
                },
                {
                  "type": "code-line",
                  "children": [
                    {
                      "text": "describe('ToDoList component', () => {"
                    }
                  ]
                },
                {
                  "type": "code-line",
                  "children": [
                    {
                      "text": "  describe('when the button is clicked with the input filled out, the new task should be added to the state', () => {"
                    }
                  ]
                },
                {
                  "type": "code-line",
                  "children": [
                    {
                      "text": "    it('a post request should be made', () => {"
                    }
                  ]
                },
                {
                  "type": "code-line",
                  "children": [
                    {
                      "text": "      const toDoListInstance = shallow("
                    }
                  ]
                },
                {
                  "type": "code-line",
                  "children": [
                    {
                      "text": "        <ToDoList/>"
                    }
                  ]
                },
                {
                  "type": "code-line",
                  "children": [
                    {
                      "text": "      );"
                    }
                  ]
                },
                {
                  "type": "code-line",
                  "children": [
                    {
                      "text": "      const postSpy = jest.spyOn(axios, 'post');"
                    }
                  ]
                },
                {
                  "type": "code-line",
                  "children": [
                    {
                      "text": ""
                    }
                  ]
                },
                {
                  "type": "code-line",
                  "children": [
                    {
                      "text": "      const newTask = 'new task name';"
                    }
                  ]
                },
                {
                  "type": "code-line",
                  "children": [
                    {
                      "text": "      const taskInput = toDoListInstance.find('input');"
                    }
                  ]
                },
                {
                  "type": "code-line",
                  "children": [
                    {
                      "text": "      taskInput.simulate('change', { target: { value: newTask }});"
                    }
                  ]
                },
                {
                  "type": "code-line",
                  "children": [
                    {
                      "text": ""
                    }
                  ]
                },
                {
                  "type": "code-line",
                  "children": [
                    {
                      "text": "      const button = toDoListInstance.find('button');"
                    }
                  ]
                },
                {
                  "type": "code-line",
                  "children": [
                    {
                      "text": "      button.simulate('click');"
                    }
                  ]
                },
                {
                  "type": "code-line",
                  "children": [
                    {
                      "text": ""
                    }
                  ]
                },
                {
                  "type": "code-line",
                  "children": [
                    {
                      "text": "      const postPromise = postSpy.mock.results.pop().value;"
                    }
                  ]
                },
                {
                  "type": "code-line",
                  "children": [
                    {
                      "text": ""
                    }
                  ]
                },
                {
                  "type": "code-line",
                  "children": [
                    {
                      "text": "      return postPromise.then((postResponse) => {"
                    }
                  ]
                },
                {
                  "type": "code-line",
                  "children": [
                    {
                      "text": "        const currentState = toDoListInstance.state();"
                    }
                  ]
                },
                {
                  "type": "code-line",
                  "children": [
                    {
                      "text": "        expect(currentState.tasks.includes((postResponse.data.task))).toBe(true);"
                    }
                  ]
                },
                {
                  "type": "code-line",
                  "children": [
                    {
                      "text": "      })"
                    }
                  ]
                },
                {
                  "type": "code-line",
                  "children": [
                    {
                      "text": "    });"
                    }
                  ]
                },
                {
                  "type": "code-line",
                  "children": [
                    {
                      "text": "  });"
                    }
                  ]
                },
                {
                  "type": "code-line",
                  "children": [
                    {
                      "text": "});"
                    }
                  ]
                }
              ]
            },
            {
              "type": "paragraph",
              "children": [
                {
                  "text": "就像上面看到的，postSpy.mock.results 是 post 函数发送结果的数组，通过使用它，我们可以得到返回的 promise，我们可以从 "
                },
                {
                  "text": "value",
                  "code": true
                },
                {
                  "text": " 属性中取到这个 promise。从测试返回 promise 是确保 Jest 等待其异步方法执行结束的一种方法。"
                }
              ]
            },
            {
              "type": "heading-three",
              "children": [
                {
                  "text": "小结"
                }
              ]
            },
            {
              "type": "paragraph",
              "children": [
                {
                  "text": "在本文中，我们介绍了 mock 模块，并将其用于伪造API调用。 由于没有发起实际的 post 请求，我们的测试可以更可靠，更快。 除此之外，我们还在整个 React 组件中模拟了事件。 我们检查了它是否产生了预期的结果，例如组件的请求或状态变化。 为此，我们了解了 spy 的概念。"
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "commit": "30543689c3e3aeca1d70b48d10be46c4176fba71",
      "id": "a7a21358",
      "articleId": "34217fa9",
      "type": "step",
      "children": [
        {
          "type": "heading-two",
          "commit": "30543689c3e3aeca1d70b48d10be46c4176fba71",
          "id": "b776bf32",
          "fixed": true,
          "children": [
            {
              "text": "尝试测试 React Hooks"
            }
          ]
        },
        {
          "type": "explain",
          "fixed": true,
          "children": [
            {
              "type": "paragraph",
              "children": [
                {
                  "text": "Hooks 是 React 的一个令人兴奋的补充，毫无疑问，它可以帮助我们将逻辑与模板分离。 这样做使上述逻辑更具可测试性。 不幸的是，测试钩子并没有那么简单。 在本文中，我们研究了如何使用 "
                },
                {
                  "text": "react-hooks-testing-library",
                  "link": true,
                  "url": "https://wanago.io/2019/12/09/javascript-design-patterns-facade-react-hooks/"
                },
                {
                  "text": " 处理它。"
                }
              ]
            }
          ]
        },
        {
          "file": "src/useModalManagement.js",
          "display": true,
          "commit": "30543689c3e3aeca1d70b48d10be46c4176fba71",
          "type": "file",
          "children": [
            {
              "type": "explain",
              "fixed": true,
              "children": [
                {
                  "type": "paragraph",
                  "children": [
                    {
                      "text": "我们创建 "
                    },
                    {
                      "text": "src/useModalManagement.js",
                      "code": true
                    },
                    {
                      "text": " 文件如下："
                    }
                  ]
                }
              ]
            },
            {
              "type": "diff-block",
              "file": "src/useModalManagement.js",
              "commit": "30543689c3e3aeca1d70b48d10be46c4176fba71",
              "hiddenLines": [],
              "children": [
                {
                  "text": ""
                }
              ]
            },
            {
              "type": "explain",
              "fixed": true,
              "children": [
                {
                  "type": "paragraph",
                  "children": [
                    {
                      "text": "上面的 Hooks 可以轻松地管理模式状态。 让我们开始测试它是否不会引发任何错误，我们创建 "
                    },
                    {
                      "text": "useModalManagement.test.js",
                      "code": true
                    }
                  ]
                }
              ]
            }
          ]
        },
        {
          "file": "src/useModalManagement.test.js",
          "display": true,
          "commit": "30543689c3e3aeca1d70b48d10be46c4176fba71",
          "type": "file",
          "children": [
            {
              "type": "explain",
              "fixed": true,
              "children": [
                {
                  "type": "paragraph",
                  "children": [
                    {
                      "text": ""
                    }
                  ]
                }
              ]
            },
            {
              "type": "diff-block",
              "file": "src/useModalManagement.test.js",
              "commit": "30543689c3e3aeca1d70b48d10be46c4176fba71",
              "hiddenLines": [],
              "children": [
                {
                  "text": ""
                }
              ]
            },
            {
              "type": "explain",
              "fixed": true,
              "children": [
                {
                  "type": "paragraph",
                  "children": [
                    {
                      "text": "我们运行测试，得到如下的结果："
                    }
                  ]
                },
                {
                  "type": "code-block",
                  "lang": "js",
                  "children": [
                    {
                      "type": "code-line",
                      "children": [
                        {
                          "text": "FAIL useModalManagement.test.js"
                        }
                      ]
                    },
                    {
                      "type": "code-line",
                      "children": [
                        {
                          "text": "  The useModalManagement hook"
                        }
                      ]
                    },
                    {
                      "type": "code-line",
                      "children": [
                        {
                          "text": "    ✕ should not throw an error按 ⌘+↩ 退出"
                        }
                      ]
                    }
                  ]
                },
                {
                  "type": "paragraph",
                  "children": [
                    {
                      "text": "不幸的是，上述测试无法正常进行。 我们可以通过阅读错误消息找出原因："
                    }
                  ]
                },
                {
                  "type": "block-quote",
                  "children": [
                    {
                      "type": "paragraph",
                      "children": [
                        {
                          "text": "无效的 Hooks 调用， Hooks 只能在函数式组件的函数体内部调用。"
                        }
                      ]
                    }
                  ]
                }
              ]
            }
          ]
        },
        {
          "file": "yarn.lock",
          "display": false,
          "commit": "30543689c3e3aeca1d70b48d10be46c4176fba71",
          "type": "file",
          "children": [
            {
              "type": "explain",
              "fixed": true,
              "children": [
                {
                  "type": "paragraph",
                  "children": [
                    {
                      "text": ""
                    }
                  ]
                }
              ]
            },
            {
              "type": "diff-block",
              "file": "yarn.lock",
              "commit": "30543689c3e3aeca1d70b48d10be46c4176fba71",
              "hiddenLines": [],
              "children": [
                {
                  "text": ""
                }
              ]
            },
            {
              "type": "explain",
              "fixed": true,
              "children": [
                {
                  "type": "paragraph",
                  "children": [
                    {
                      "text": ""
                    }
                  ]
                }
              ]
            }
          ]
        },
        {
          "type": "explain",
          "fixed": true,
          "children": [
            {
              "type": "paragraph",
              "children": [
                {
                  "text": ""
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "commit": "ab544bd53d06963af5aa7ea9258cc92012fe0d9d",
      "id": "8a6fe535",
      "articleId": "34217fa9",
      "type": "step",
      "children": [
        {
          "type": "heading-two",
          "commit": "ab544bd53d06963af5aa7ea9258cc92012fe0d9d",
          "id": "83c7217d",
          "fixed": true,
          "children": [
            {
              "text": "让测试通过"
            }
          ]
        },
        {
          "type": "explain",
          "fixed": true,
          "children": [
            {
              "type": "paragraph",
              "children": [
                {
                  "text": "React文档",
                  "link": true,
                  "url": "https://reactjs.org/docs/hooks-overview.html"
                },
                {
                  "text": " 里面提到： 我们只能从函数式组件或其他 Hooks 中调用 Hooks。 我们可以使用本系列前面部分介绍的 enzyme 库来解决此问题，而且使了一点小聪明，我们创建 "
                },
                {
                  "text": "testHook.js",
                  "code": true
                },
                {
                  "text": " ："
                }
              ]
            }
          ]
        },
        {
          "file": "src/testHook.js",
          "display": true,
          "commit": "ab544bd53d06963af5aa7ea9258cc92012fe0d9d",
          "type": "file",
          "children": [
            {
              "type": "explain",
              "fixed": true,
              "children": [
                {
                  "type": "paragraph",
                  "children": [
                    {
                      "text": ""
                    }
                  ]
                }
              ]
            },
            {
              "type": "diff-block",
              "file": "src/testHook.js",
              "commit": "ab544bd53d06963af5aa7ea9258cc92012fe0d9d",
              "hiddenLines": [],
              "children": [
                {
                  "text": ""
                }
              ]
            },
            {
              "type": "explain",
              "fixed": true,
              "children": [
                {
                  "type": "paragraph",
                  "children": [
                    {
                      "text": ""
                    }
                  ]
                }
              ]
            }
          ]
        },
        {
          "file": "src/useModalManagement.test.js",
          "display": true,
          "commit": "ab544bd53d06963af5aa7ea9258cc92012fe0d9d",
          "type": "file",
          "children": [
            {
              "type": "explain",
              "fixed": true,
              "children": [
                {
                  "type": "paragraph",
                  "children": [
                    {
                      "text": "我们继续迭代 "
                    },
                    {
                      "text": "useModalManagement.test.js",
                      "code": true
                    },
                    {
                      "text": "，修改内容如下："
                    }
                  ]
                }
              ]
            },
            {
              "type": "diff-block",
              "file": "src/useModalManagement.test.js",
              "commit": "ab544bd53d06963af5aa7ea9258cc92012fe0d9d",
              "hiddenLines": [],
              "children": [
                {
                  "text": ""
                }
              ]
            },
            {
              "type": "explain",
              "fixed": true,
              "children": [
                {
                  "type": "paragraph",
                  "children": [
                    {
                      "text": ""
                    }
                  ]
                }
              ]
            }
          ]
        },
        {
          "type": "explain",
          "fixed": true,
          "children": [
            {
              "type": "paragraph",
              "children": [
                {
                  "text": "我们允许测试，得到如下结果："
                }
              ]
            },
            {
              "type": "code-block",
              "children": [
                {
                  "type": "code-line",
                  "children": [
                    {
                      "text": "PASS useModalManagement.test.js"
                    }
                  ]
                },
                {
                  "type": "code-line",
                  "children": [
                    {
                      "text": "  The useModalManagement hook"
                    }
                  ]
                },
                {
                  "type": "code-line",
                  "children": [
                    {
                      "text": "    ✓ should not throw an error"
                    }
                  ]
                }
              ],
              "lang": "javascript"
            },
            {
              "type": "paragraph",
              "children": [
                {
                  "text": "好多了！ 但是，上述解决方案不是很好，并且不能为我们提供进一步测试 Hooks 的舒适方法。 这就是我们使用  "
                },
                {
                  "text": "react-hooks-testing-library",
                  "link": true,
                  "url": "https://wanago.io/2019/12/09/javascript-design-patterns-facade-react-hooks/"
                },
                {
                  "text": "   的原因，我们将在下一篇教程里讲解如何更加舒适的测试 React Hooks 的方法，敬请期待！"
                }
              ]
            }
          ]
        }
      ]
    }
  ],
  "github": "https://github.com/tuture-dev/javascript-test-series",
  "remotes": [],
  "version": "v1"
}